/*! Bergson 1.0.0, Copyright 2015 Colin Clark | github.com/colinbdclark/bergson */

var fluid_2_0=fluid_2_0||{},fluid=fluid||fluid_2_0;!function(a){"use strict";var b=Object.prototype.toString,c=Object.prototype.hasOwnProperty,d=Array.prototype.indexOf,e="undefined"!=typeof window?window:self,f=e.jQuery,g=e.$,h=/^\s+/,i=/\s+$/,j=String.prototype.trim,k=a.jQueryStandalone={jquery:"1.6.1-fluidStandalone",noConflict:function(a){return e.$===k&&(e.$=g),a&&e.jQuery===k&&(e.jQuery=f),k},isArray:Array.isArray||function(a){return"[object Array]"===b.call(a)},trim:j?function(a){return null===a?"":j.call(a)}:function(a){return null===a?"":a.toString().replace(h,"").replace(i,"")},isWindow:function(a){return a&&"object"==typeof a&&"setInterval"in a},isPlainObject:function(a){if(!a||"[object Object]"!==b.call(a)||a.nodeType||k.isWindow(a))return!1;if(a.constructor&&!c.call(a,"constructor")&&!c.call(a.constructor.prototype,"isPrototypeOf"))return!1;var d;for(d in a);return void 0===d||c.call(a,d)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},inArray:function(a,b){if(d)return d.call(b,a);for(var c=0,e=b.length;e>c;c++)if(b[c]===a)return c;return-1},extend:function(){var a,b=arguments[0]||{},c=1,d=arguments.length,e=!1;for("boolean"==typeof b&&(e=b,b=arguments[1]||{},c=2),"object"!=typeof b&&"function"!=typeof b&&(b={});d>c;c++)if(null!==(a=arguments[c]))for(var f in a){var g=b[f],h=a[f];if(b!==h){var i,j;e&&h&&(k.isPlainObject(h)||(i=k.isArray(h)))?(i?(i=!1,j=g&&k.isArray(g)?g:[]):j=g&&k.isPlainObject(g)?g:{},b[f]=k.extend(e,j,h)):void 0!==h&&(b[f]=h)}}return b}}}(fluid_2_0);var jQuery=fluid.jQueryStandalone,fluid_2_0=fluid_2_0||{},fluid=fluid||fluid_2_0;!function(a,b){"use strict";function c(a,b,c,d){for(var e=a[c],f=0;f<d.length-1;++f)e=d[f+1](e,c);b[c]=e}function d(a,c,d,e){for(var f=0;d>f;++f)a=e(a,c[f],f,b.makeArray(c));return a}function e(a,b,c,e){for(var f=[],g=0;g<a.length;++g){var h=d(a[g],b,c,e[g]);void 0!==h&&f.push(h)}return f}b.version="Infusion 2.0-SNAPSHOT",b.Error=Error,b.environment={fluid:b};var f="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0;b.global=b.global||f||{},b.invokeLater=function(a){return setTimeout(a,1)},b.defeatLogging=!0,b.activityTracing=!1,b.activityTrace=[];var g=/(%\w+)/g;b.renderOneActivity=function(a,b){for(var c=b===!0?[]:["    while "],d=a.message,e=g.lastIndex=0;;){var f=g.exec(d);if(!f)break;var h=f[1].substring(1);c.push(d.substring(e,f.index)),c.push(a.args[h]),e=g.lastIndex}return e<d.length&&c.push(d.substring(e)),c},b.renderActivity=function(a,c){return c=c||b.renderOneActivity,b.transform(a,c)},b.getActivityStack=function(){var a=b.globalThreadLocal();return a.activityStack||(a.activityStack=[]),a.activityStack},b.describeActivity=b.getActivityStack,b.logActivity=function(a){a=a||b.describeActivity();var c=b.renderActivity(a).reverse();b.log("Current activity: "),b.each(c,function(a){b.doLog(a)})},b.pushActivity=function(a,c,d){var e={type:a,message:c,args:d,time:(new Date).getTime()};b.activityTracing&&b.activityTrace.push(e),b.passLogLevel(b.logLevel.TRACE)&&b.doLog(b.renderOneActivity(e,!0));var f=b.getActivityStack();f.push(e)},b.popActivity=function(a){a=a||1,b.activityTracing&&b.activityTrace.push({pop:a});var c=b.getActivityStack(),d=c.length-a;c.length=0>d?0:d},b.FluidError=function(a){this.message=a,this.stack=(new Error).stack},b.FluidError.prototype=new Error,b.builtinFail=function(a,c,d){b.log.apply(null,[b.logLevel.FAIL,"ASSERTION FAILED: "].concat(c)),b.logActivity(d);var e=c.join("");if(a)throw new b.FluidError(e);e["Assertion failure - check console for details"]()};var h=[!1];b.fail=function(){var a=b.makeArray(arguments),c=b.makeArray(b.describeActivity());b.popActivity(c.length);var d=h[0];"boolean"==typeof d?b.builtinFail(d,a,c):"function"==typeof d&&d(a,c)},b.pushSoftFailure=function(a){"boolean"==typeof a||"function"==typeof a?h.unshift(a):-1===a&&h.shift()},b.notrycatch=!0,b.tryCatch=function(a,c,d){if(d=d||b.identity,b.notrycatch){var e=a();return d(),e}try{return a()}catch(f){if(!c)throw f;c(f)}finally{d()}},b.expect=function(a,c,d){b.transform(b.makeArray(c),function(c){"undefined"==typeof d[c]&&b.fail(a+" missing required parameter "+c)})},b.isLogging=function(){return i[0].priority>b.logLevel.IMPORTANT.priority},b.isLogLevel=function(a){return b.isMarker(a)&&void 0!==a.priority},b.passLogLevel=function(a){return a.priority<=i[0].priority},b.setLogging=function(a){var c;"boolean"==typeof a?c=b.logLevel[a?"INFO":"IMPORTANT"]:b.isLogLevel(a)?c=a:b.fail("Unrecognised fluid logging level ",a),i.unshift(c)},b.setLogLevel=b.setLogging,b.popLogging=function(){return 1===i.length?i[0]:i.shift()},b.doLog=function(a){var b=a.join("");"undefined"!=typeof console?console.debug?console.debug.apply(console,a):"function"==typeof console.log?console.log.apply(console,a):console.log(b):"undefined"!=typeof YAHOO?YAHOO.log(b):"undefined"!=typeof opera&&opera.postError(b)},b.log=function(){var a=b.makeArray(arguments),c=b.logLevel.INFO;if(b.isLogLevel(a[0])&&(c=a.shift()),b.passLogLevel(c)){var d=b.renderTimestamp(new Date)+":  ",e=[d].concat(a);b.doLog(e)}},b.identity=function(a){return a},b.isValue=function(a){return void 0!==a&&null!==a},b.isPrimitive=function(a){var b=typeof a;return!a||"string"===b||"boolean"===b||"number"===b||"function"===b},b.isArrayable=function(a){return a&&(a.jquery||"[object Array]"===Object.prototype.toString.call(a))},b.isPlainObject=function(a){if(!a)return!1;var b=Object.prototype.toString.call(a);return"[object Array]"===b||"[object Object]"===b},b.isDOMNode=function(a){return a&&"number"==typeof a.nodeType},b.isDOMish=function(a){return b.isDOMNode(a)||a.jquery},b.isComponent=function(a){return a&&a.typeName&&a.id},b.freshContainer=function(a){return b.isArrayable(a)?[]:{}},b.copy=function(c){return b.isPrimitive(c)?c:a.extend(!0,b.freshContainer(c),c)},b.makeArray=function(a){var c=[];if(null!==a&&void 0!==a)if(b.isPrimitive(a)||"number"!=typeof a.length)c.push(a);else for(var d=0;d<a.length;++d)c[d]=a[d];return c},b.transform=function(a){var d=b.freshContainer(a);if(b.isArrayable(a))for(var e=0;e<a.length;++e)c(a,d,e,arguments);else for(var f in a)c(a,d,f,arguments);return d},b.each=function(a,c){if(b.isArrayable(a))for(var d=0;d<a.length;++d)c(a[d],d);else for(var e in a)c(a[e],e)},b.make_find=function(a){var c=a?!1:void 0;return function(d,e,f){var g;if(b.isArrayable(d)){for(var h=0;h<d.length;++h)if(g=e(d[h],h),g!==c)return a?d[h]:g}else for(var i in d)if(g=e(d[i],i),g!==c)return a?d[i]:g;return f}},b.find=b.make_find(!1),b.find_if=b.make_find(!0),b.accumulate=function(a,b,c){for(var d=0;d<a.length;++d)c=b(a[d],c,d);return c},b.remove_if=function(a,c,d){if(b.isArrayable(a))for(var e=a.length-1;e>=0;--e)c(a[e],e)&&(d&&d.unshift(a[e]),a.splice(e,1));else for(var f in a)c(a[f],f)&&(d&&(d[f]=a[f]),delete a[f]);return d||a},b.generate=function(a,b,c){for(var d=[],e=0;a>e;++e)d[e]=c?b(e):b;return d},b.iota=function(a,b){b=b||0;for(var c=[],d=0;a>d;++d)c[c.length]=b++;return c},b.getMembers=function(a,c){return b.transform(a,function(a){return b.get(a,c)})},b.filterKeys=function(c,d,e){return b.remove_if(a.extend({},c),function(b,c){return e^-1===a.inArray(c,d)})},b.censorKeys=function(a,c){return b.filterKeys(a,c,!0)},b.makeFlatten=function(a){return function(c){var d=[];return b.each(c,function(){d.push(arguments[a])}),d}},b.keys=b.makeFlatten(1),b.values=b.makeFlatten(0),b.contains=function(c,d){return c?b.isArrayable(c)?-1!==a.inArray(d,c):b.find(c,function(a){return d===a?!0:void 0}):void 0},b.keyForValue=function(a,c){return b.find(a,function(a,b){return c===a?b:void 0})},b.findKeyInObject=b.keyForValue,b.arrayToHash=function(a){var c={};return b.each(a,function(a){c[a]=!0}),c},b.flatten=function(a){var c=[];return b.each(a,function(a){b.isArrayable(a)?c=c.concat(a):c.push(a)}),c},b.clear=function(a){if(b.isArrayable(a))a.length=0;else for(var c in a)delete a[c]},b.compareStringLength=function(a){return a?function(a,b){return a.length-b.length}:function(a,b){return b.length-a.length}},b.parseInteger=function(a){return isFinite(a)&&a%1===0?Number(a):NaN},b.logLevelsSpec={FATAL:0,FAIL:5,WARN:10,IMPORTANT:12,INFO:15,TRACE:20},b.logLevel=b.transform(b.logLevelsSpec,function(a,b){return{type:"fluid.marker",value:b,priority:a}});var i=[b.logLevel.IMPORTANT];b.VALUE={type:"fluid.marker",value:"VALUE"},b.NO_VALUE={type:"fluid.marker",value:"NO_VALUE"},b.EXPAND={type:"fluid.marker",value:"EXPAND"},b.EXPAND_NOW={type:"fluid.marker",value:"EXPAND_NOW"},b.isMarker=function(a,b){return a&&"object"==typeof a&&"fluid.marker"===a.type?b?a.value===b.value:!0:!1},b.model={},b.model.copyModel=function(c,d){b.clear(c),a.extend(!0,c,d)},b.model.parseEL=function(a){return""===a?[]:String(a).split(".")},b.model.composePath=function(a,b){return""===a?b:""===b?a:a+"."+b},b.model.composeSegments=function(){return b.makeArray(arguments).join(".")},b.path=b.model.composeSegments,b.composePath=b.model.composePath,b.requireDataBinding=function(){b.fail("Please include DataBinding.js in order to operate complex model accessor configuration")},b.model.setWithStrategy=b.model.getWithStrategy=b.requireDataBinding,b.model.resolvePathSegment=function(a,b,c,d){return!d&&a.resolvePathSegment?a.resolvePathSegment(b):c&&void 0===a[b]?a[b]={}:a[b]},b.model.pathToSegments=function(a,c){var d=c&&c.parser?c.parser.parse:b.model.parseEL,e="number"==typeof a||"string"==typeof a?d(a):a;return e},b.model.accessImpl=function(a,c,d,e,f,g,h){var i=b.model.pathToSegments(c,e),j=0;f&&(j=f.length,i=f.concat(i));var k=d===b.NO_VALUE?0:1;return a=h(a,i,j,e,k),d===b.NO_VALUE||d===b.VALUE?g?{root:a,segs:i}:a:void(a[i[i.length-1]]=d)},b.model.accessSimple=function(a,c,d,e,f,g){return b.model.accessImpl(a,c,d,e,f,g,b.model.traverseSimple)},b.model.traverseSimple=function(a,c,d,e,f){for(var g=e,h=c.length-f,i=0;h>i;++i){if(!a)return a;var j=c[i];a=e&&e[j]?e[j]:b.model.resolvePathSegment(a,j,1===f,g),e=null}return a},b.model.setSimple=function(a,c,d,e,f){b.model.accessSimple(a,c,d,e,f,!1)},b.model.getSimple=function(a,c,d,e){return null===c||void 0===c||0===c.length?a:b.model.accessSimple(a,c,b.NO_VALUE,d,e,!1)},b.decodeAccessorArg=function(a){return a&&a!==b.model.defaultGetConfig&&a!==b.model.defaultSetConfig?"environment"===a.type?a.value:void 0:null},b.set=function(a,c,d,e,f){var g=b.decodeAccessorArg(e);void 0===g?b.model.setWithStrategy(a,c,d,e,f):b.model.setSimple(a,c,d,g,f)},b.get=function(a,c,d,e){var f=b.decodeAccessorArg(d);return void 0===f?b.model.getWithStrategy(a,c,d,e):b.model.accessImpl(a,c,b.NO_VALUE,f,null,!1,b.model.traverseSimple)},b.model.setBeanValue=b.set,b.model.getBeanValue=b.get,b.getGlobalValue=function(a,c){return a?(c=c||b.environment,b.get(b.global,a,{type:"environment",value:c})):void 0},b.bind=function(a,c,d){return a[c].apply(a,b.makeArray(d))},b.invokeGlobalFunction=function(a,c,d){var e=b.getGlobalValue(a,d);return e?e.apply(null,c||[]):void b.fail("Error invoking global function: "+a+" could not be located")},b.registerGlobalFunction=function(a,c,d){d=d||b.environment,b.set(b.global,a,c,{type:"environment",value:d})},b.setGlobalValue=b.registerGlobalFunction,b.registerNamespace=function(a,c){c=c||b.environment;var d=b.getGlobalValue(a,c);return d||(d={},b.setGlobalValue(a,d,c)),d},b.dumpEl=b.identity,b.renderTimestamp=b.identity,b.registerNamespace("fluid.event"),b.generateUniquePrefix=function(){return Math.floor(1e12*Math.random()).toString(36)+"-"};var j=b.generateUniquePrefix();b.fluidInstance=j;var k=1;b.allocateGuid=function(){return j+k++},b.event.identifyListener=function(a,c){return"string"==typeof a||a.$$fluid_guid||c||(a.$$fluid_guid=b.allocateGuid()),a.$$fluid_guid},b.event.impersonateListener=function(a,c){b.event.identifyListener(a),c.$$fluid_guid=a.$$fluid_guid},b.event.mapPriority=function(a,b){return null===a||void 0===a?b:"last"===a?Number.MAX_VALUE:"first"===a?-Number.MAX_VALUE:-a},b.priorityComparator=function(a,b){return a.priority-b.priority},b.event.sortListeners=function(a){var c=[];return b.each(a,function(a){for(var b,d=0;d<a.length;++d){var e=a[d];e.softNamespace||b||(b=e)}b?c.push(b):c=c.concat(a)}),c.sort(b.priorityComparator)},b.event.invokeListener=function(a,c){return"string"==typeof a&&(a=b.event.resolveListener({globalName:a})),a.apply(null,c)},b.event.resolveListener=function(a){if(a.globalName){var c=b.getGlobalValue(a.globalName);c?a=c:b.fail("Unable to look up name "+a.globalName+" as a global function")}return a},b.nameComponent=function(a){return a?"component with typename "+a.typeName+" and id "+a.id:"[unknown component]"},b.event.nameEvent=function(a,c){return c+" of "+b.nameComponent(a)},b.makeEventFirer=function(a){function c(c,f,g){if(c&&!d.destroyed){b.log(b.logLevel.TRACE,"Firing event "+e+" to list of "+c.length+" listeners");for(var h=0;h<c.length;++h){var i=c[h];i.listener=b.event.resolveListener(i.listener);var j=i.listener;if(!i.predicate||i.predicate(j,f)){var k,l=(g?g(j):j).apply(null,f);if((a.preventable&&l===!1||d.destroyed)&&(k=!1),void 0!==k)return k}}}}a=a||{};var d,e=a.name||"<anonymous>",f=b.event.identifyListener,g=function(){d.listeners={},d.byId={},d.sortedListeners=[],d.addListener=function(a,c,e,g,h){if(d.destroyed&&b.fail("Cannot add listener to destroyed event firer "+d.name),a){"string"==typeof a&&(a={globalName:a});var i=f(a);c=c||i;var j={listener:a,predicate:e,namespace:c,softNamespace:h,priority:b.event.mapPriority(g,d.sortedListeners.length)};d.byId[i]=j;var k=d.listeners[c]=b.makeArray(d.listeners[c]);k[h?"push":"unshift"](j),d.sortedListeners=b.event.sortListeners(d.listeners)}},d.addListener.apply(null,arguments)};return d={eventId:b.allocateGuid(),name:e,ownerId:a.ownerId,typeName:"fluid.event.firer",destroy:function(){d.destroyed=!0},addListener:function(){g.apply(null,arguments)},removeListener:function(a){if(d.listeners){var c,e,g;if("string"==typeof a){if(c=a,g=d.listeners[c],!g)return}else"function"==typeof a&&(e=f(a,!0),e||b.fail("Cannot remove unregistered listener function ",a," from event "+d.name));var h=d.byId[e],i=h&&h.softNamespace;c=c||h&&h.namespace||e,delete d.byId[e],g=d.listeners[c],g&&(i?b.remove_if(g,function(a){return a.listener.$$fluid_guid===e}):g.shift(),0===g.length&&delete d.listeners[c],d.sortedListeners=b.event.sortListeners(d.listeners))}},fireToListeners:function(a,b,d){return c(a,b,d)},fire:function(){return c(d.sortedListeners,arguments)}}},b.fireEvent=function(a,c,d){var e=b.get(a,c);e&&e.fire.apply(null,b.makeArray(d))},b.event.addListenerToFirer=function(a,c,d,e){if(e=e||b.identity,b.isArrayable(c))for(var f=0;f<c.length;++f)b.event.addListenerToFirer(a,c[f],d,e);else"function"==typeof c||"string"==typeof c?e(a).addListener(c,d):c&&"object"==typeof c&&e(a).addListener(c.listener,d||c.namespace,c.predicate,c.priority,c.softNamespace)},b.event.resolveListenerRecord=function(a){return{records:a}},b.expandOptions=function(a){b.fail("fluid.expandOptions could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor "+a)},b.mergeListeners=function(a,c,d){b.each(d,function(d,e){var f,g;if("{"===e.charAt(0))f=b.expandOptions(e,a),f||b.fail("Error in listener record: key "+e+' could not be looked up to an event firer - did you miss out "events." when referring to an event firer?');else{var h=e.indexOf(".");-1!==h&&(g=e.substring(h+1),e=e.substring(0,h)),c[e]||b.fail("Listener registered for event "+e+" which is not defined for this component"),f=c[e]}var i=b.event.resolveListenerRecord(d,a,e,g,!0);b.event.addListenerToFirer(f,i.records,g,i.adderWrapper)})},b.eventFromRecord=function(a,c,d){var e,f=a&&("string"!=typeof a||"{"===a.charAt(0));return f?b.event.resolveEvent?e=b.event.resolveEvent(d,c,a):b.fail("fluid.event.resolveEvent could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor ",a):e=b.makeEventFirer({name:b.event.nameEvent(d,c),preventable:"preventable"===a,ownerId:d.id}),e},b.instantiateFirers=function(a,c){b.each(c.events,function(c,d){a.events[d]=b.eventFromRecord(c,d,a)})},b.mergeListenerPolicy=function(a,c,d){"string"!=typeof d&&b.fail("Error in listeners declaration - the keys in this structure must resolve to event names - got "+d+" from ",c);var e="{"!==d.charAt(0)&&-1!==d.indexOf(".");return e?c||a:b.arrayConcatPolicy(a,c)},b.makeMergeListenersPolicy=function(a){return function(c,d){return c=c||{},b.each(d,function(b,d){c[d]=a(c[d],b,d)}),c}},b.unique=function(a){return b.remove_if(a,function(b,c){return!b||c>0&&b===a[c-1]})},b.arrayConcatPolicy=function(a,c){return b.makeArray(a).concat(b.makeArray(c))},b.typeTag=function(a){return a?{typeName:a,id:b.allocateGuid()}:null},b.staticEnvironment=b.typeTag("fluid.staticEnvironment"),b.singleThreadLocal=function(a){var b=a();return function(a){return void 0===a?b:b=a}},b.threadLocal=b.singleThreadLocal,b.globalThreadLocal=b.threadLocal(function(){return b.typeTag("fluid.dynamicEnvironment")});var l=1,m={},n={},o=function(a,c,d){var e=!0;return d?e=1===c.length:c=b.makeArray(c),b.each(c,function(c){if(c&&!a.gradeHash[c]){var d="{"===c.charAt(0),f=(d?null:e?b.rawDefaults(c):b.getGradedDefaults(c))||{},g=m[c]||l-1;a.lastTick=Math.max(a.lastTick,g),a.gradeHash[c]=!0,a.gradeChain.push(c),a.optionsChain.push(f);for(var h=b.makeArray(f.gradeNames),i=0;i<h.length;++i){var j=h[i],k="autoInit"===j;e?k||o(a,j):a.gradeHash[j]||k||(a.gradeHash[j]=!0,a.gradeChain.push(j))}}}),a};b.resolveGradeStructure=function(a,c){var d={lastTick:0,gradeChain:[],gradeHash:{},optionsChain:[]};return o(d,(b.makeArray(c).reverse()||[]).concat([a]),!0)};var p={};b.gradeNamesToKey=function(a,b){return a+"|"+b.join("|")},b.hasGrade=function(a,c){return a&&a.gradeNames?b.contains(a.gradeNames,c):!1},b.resolveGrade=function(c,d,e){for(var f=b.resolveGradeStructure(d,e),g=f.optionsChain.reverse(),h={},i=0;i<g.length;++i)g[i]&&g[i].mergePolicy&&(h=a.extend(!0,h,g[i].mergePolicy));g=[h,{}].concat(g);var j=b.merge.apply(null,g);return j.gradeNames=f.gradeChain,b.hasGrade(c,"autoInit")&&j.gradeNames.push("autoInit"),{defaults:j,lastTick:f&&f.lastTick}},b.getGradedDefaults=function(a,c){c=b.makeArray(c);var d=b.gradeNamesToKey(a,c),e=p[d];if(e){for(var f=0,g=e.defaults.gradeNames||[],h=0;h<g.length;++h)f=Math.max(f,m[g[h]]||0);f>e.lastTick&&(b.log("Clearing cache for component "+a+" with gradeNames ",g),e=null)}if(!e){var i=b.rawDefaults(a);if(!i)return i;e=p[d]=b.resolveGrade(i,a,c)}return e.defaults},b.annotateListeners=function(a,c){c.listeners&&(c.listeners=b.transform(c.listeners,function(c){var d=b.makeArray(c);return b.transform(d,function(c){return b.isPrimitive(c)||(c.componentSource=a),c})}))},b.rawDefaults=function(a,c){if(void 0===c)return n[a];b.pushActivity("registerDefaults","registering defaults for grade %componentName with options %options",{componentName:a,options:c});var d=b.expandCompact?b.expandCompact(c):b.copy(c);b.annotateListeners(a,d),n[a]=d,m[a]=l++,b.popActivity()},b.doIndexDefaults=function(a,c,d,e){for(var f=b.makeArray(e.gradeNames),g=0;g<f.length;++g)if(!b.hasGrade(c,f[g]))return;for(var h="function"==typeof e.indexFunc?e.indexFunc:b.getGlobalValue(e.indexFunc),i=h(c)||[],j=0;j<i.length;++j)(d[i[j]]=d[i[j]]||[]).push(a)},b.indexDefaults=function(a,c){var d={};for(var e in n){var f=b.getGradedDefaults(e);b.doIndexDefaults(e,f,d,c)}return d},b.defaults=function(a,c){return void 0===c?b.getGradedDefaults(a):(c&&c.options&&b.fail("Probable error in options structure for "+a+' with option named "options" - perhaps you meant to write these options at top level in fluid.defaults? - ',c),b.rawDefaults(a,c),b.hasGrade(c,"autoInit")&&b.makeComponent(a,b.getGradedDefaults(a)),void 0)},b.makeComponent=function(c,d){if(d.gradeNames&&0!==d.gradeNames.length){if(!d.initFunction){for(var e=[],f=0;f<d.gradeNames.length;++f){var g=d.gradeNames[f],h=b.rawDefaults(g);h||"autoInit"===g||e.push(g)}0===e.length?b.fail("Cannot autoInit component "+c+" which does not have an initFunction defined"):b.fail("The grade hierarchy of component with typeName "+c+" is incomplete - it inherits from the following grade(s): "+e.join(", ")+" for which the grade definitions are corrupt or missing. Please check the files which might include these grades and ensure they are readable and have been loaded by this instance of Infusion")}}else b.fail("Cannot autoInit component "+c+" which does not have any gradeNames defined");var i=function(){return b.initComponent(c,arguments)},j=b.getGlobalValue(c);j&&a.extend(i,j),b.setGlobalValue(c,i)},b.makeComponents=function(a){b.each(a,function(a,c){var d={gradeNames:b.makeArray(a).concat(["autoInit"])};b.defaults(c,d)})},b.model.mergeModel=function(c,d){if(!b.isPrimitive(c)){var e=b.copy(d);a.extend(!0,d,c),a.extend(!0,d,e)}return d};var q={};b.derefMergePolicy=function(a){return(a?a["*"]:q)||q},b.compileMergePolicy=function(a){var c={},d={},e={builtins:c,defaultValues:d};return a?(b.each(a,function(a,f){var g={},h=!0;if("function"==typeof a)g.func=a;else if("object"==typeof a)g=a;else if(b.isDefaultValueMergePolicy(a))b.set(d,f,"{that}.options."+a),e.hasDefaults=!0,h=!1;else for(var i=a.split(/\s*,\s*/),j=0;j<i.length;++j)g[i[j]]=!0;h&&b.set(c,b.composePath(f,"*"),g)}),e):e},b.isDefaultValueMergePolicy=function(a){return"string"==typeof a&&-1===a.indexOf(",")&&!/replace|preserve|nomerge|noexpand/.test(a)},b.mergeOneImpl=function(a,c,d,e,f,g,h){var i=a,j=b.isPrimitive(a);return void 0!==c&&(f.func||null===c||!b.isPlainObject(c)||b.isDOMish(c)||c===b.VALUE||f.preserve||f.nomerge?(e[d]=void 0,i=f.func?f.func.call(null,a,c,h[g-1],h,g):b.isValue(a)&&f.preserve?b.model.mergeModel(a,c):c):j&&(i=a=b.freshContainer(c))),i},b.fetchMergeChildren=function(a,c,d,e,f,g){for(var h=b.derefMergePolicy(f),i=e.length-1;i>=0;--i){var j=e[i];if(void 0!==j&&(b.each(j,function(b,h){a.hasOwnProperty(h)||(d[c]=h,g.strategy(a,h,c+1,d,e,f))}),h.replace))break}return a},b.inEvaluationMarker={__CURRENTLY_IN_EVALUATION__:!0},b.destroyedMarker={__COMPONENT_DESTROYED__:!0},b.strategyRecursionBailout=50,b.makeMergeStrategy=function(a){var c=function(c,f,g,h,i,j){if(g>b.strategyRecursionBailout&&b.fail("Overflow/circularity in options merging, current path is ",h," at depth ",g,' - please protect components from merging using the "nomerge" merge policy'),b.isPrimitive(c))return void 0;b.isTracing&&b.tracing.pathCount.push(b.path(h.slice(0,g)));var k;if(c.hasOwnProperty(f)){if(k=c[f],!a.evaluateFully)return k}else c[f]=b.inEvaluationMarker;void 0===i&&(h=b.makeArray(h),i=e(a.sources,h,g-1,a.sourceStrategies),j=d(a.mergePolicy,h,g-1,b.concreteTrundler));var l,m,n,o=b.concreteTrundler(j,f),p=b.derefMergePolicy(o);p.replace?(l=1-i.length,m=0,n=-1):(l=0,m=i.length-1,n=1);for(var q,r=[],s=l;m>=s;++s){var t=n*s,u=a.sourceStrategies[t](i[t],f,g,h);if(void 0!==u&&(r[t]=u,void 0===k)){if(-1===n){q=c[f]=u;break}q=c[f]=b.mergeOneImpl(q,u,s,r,p,g,h,a)}}return void 0!==k&&(q=k),r.length>0&&(b.isPrimitive(q)||b.fetchMergeChildren(q,g,h,r,o,a)),void 0===k&&0===r.length&&delete c[f],q};return a.strategy=c,c},b.driveStrategy=function(a,c,d){c=b.makeArray(c);for(var e=0;e<c.length;++e){if(!a)return void 0;a=d(a,c[e],e+1,c)}return a},b.concreteTrundler=function(a,b){return a?a[b]:void 0},b.merge=function(a){var c=Array.prototype.slice.call(arguments,1),d=b.compileMergePolicy(a).builtins,e=b.makeMergeOptions(d,c,{});return e.initter(),e.target},b.simpleGingerBlock=function(a,c){var d={target:a,simple:!0,strategy:b.concreteTrundler,initter:b.identity,recordType:c,priority:b.mergeRecordTypes[c]};return d},b.makeMergeOptions=function(c,d,e){var f={mergePolicy:c,sources:d};return f=a.extend(f,e),f.target=f.target||b.freshContainer(f.sources[0]),f.sourceStrategies=f.sourceStrategies||b.generate(f.sources.length,b.concreteTrundler),f.initter=function(){f.evaluateFully=!0,b.fetchMergeChildren(f.target,0,[],f.sources,f.mergePolicy,f)},b.makeMergeStrategy(f),f},b.transformOptions=function(a,c){b.expect("Options transformation record",["transformer","config"],c);var d=b.getGlobalValue(c.transformer);return d.call(null,a,c.config)},b.findMergeBlocks=function(a,c){return b.remove_if(b.makeArray(a),function(a){return a.recordType!==c})},b.transformOptionsBlocks=function(a,c,d){b.each(d,function(d){var e=b.findMergeBlocks(a,d);b.each(e,function(a){a[a.simple?"target":"source"]=b.transformOptions(a.source,c)})})},b.deliverOptionsStrategy=b.identity,b.computeComponentAccessor=b.identity,b.computeDynamicComponents=b.identity,b.mergeRecordTypes={defaults:0,localOptions:50,defaultValueMerge:100,subcomponentRecord:200,distribution:300,user:500,demands:600},b.destroyValue=function(a,c){a&&b.model.applyChangeRequest(a,{type:"DELETE",path:c})},b.mergeComponentOptions=function(c,d,e,f){function g(){s=b.driveStrategy(l,"mergePolicy",q.strategy),s=a.extend({},b.rootMergePolicy,s),r=b.compileMergePolicy(s),a.extend(!0,j,r.builtins)}var h=b.rawDefaults(d),i=b.getGradedDefaults(d,h&&h.gradeNames?null:f.gradeNames),j={},k=[];k=b.expandComponentOptions?k.concat(b.expandComponentOptions(j,i,e,c)):k.concat([b.simpleGingerBlock(i,"defaults"),b.simpleGingerBlock(e,"user")]);var l={},m=[],n=[],o={target:l,sourceStrategies:m},p=function(){k.sort(b.priorityComparator),m.length=0,n.length=0,b.each(k,function(a){m.push(a.strategy),n.push(a.target)})};p();var q=b.makeMergeOptions(j,n,o);q.mergeBlocks=k,q.updateBlocks=p,q.destroyValue=function(a){for(var c=0;c<k.length;++c)b.destroyValue(k[c].target,a);b.destroyValue(o.target,a)};var r,s;g(),r.hasDefaults&&(b.generateExpandBlock?(k.push(b.generateExpandBlock({options:r.defaultValues,recordType:"defaultValueMerge",priority:b.mergeRecordTypes.defaultValueMerge},c,{})),p()):b.fail("Cannot operate mergePolicy ",s," for component ",c," without including FluidIoC.js")),c.options=l;var t=b.driveStrategy(l,"nickName",q.strategy);c.nickName=t||b.computeNickName(c.typeName),b.driveStrategy(l,"gradeNames",q.strategy),b.deliverOptionsStrategy(c,l,q);var u=b.driveStrategy(l,"transformOptions",q.strategy);return u&&(b.transformOptionsBlocks(k,u,["user","subcomponentRecord"]),p()),b.computeComponentAccessor(c),o.target.mergePolicy||g(),q},b.defaults("fluid.function",{}),b.invokeGradedFunction=function(a,c){var d=b.defaults(a);d&&d.argumentMap&&b.hasGrade(d,"fluid.function")||b.fail("Cannot look up name "+a+" to a function with registered argumentMap - got defaults ",d);var e=[];return b.each(d.argumentMap,function(a,b){e[a]=c[b]}),b.invokeGlobalFunction(a,e)},b.lifecycleFunctions={preInitFunction:!0,postInitFunction:!0,finalInitFunction:!0},b.rootMergePolicy=a.extend({gradeNames:b.arrayConcatPolicy,distributeOptions:b.arrayConcatPolicy,transformOptions:"replace"},b.transform(b.lifecycleFunctions,function(){return b.mergeListenerPolicy})),b.defaults("fluid.littleComponent",{gradeNames:["autoInit"],initFunction:"fluid.initLittleComponent",mergePolicy:b.rootMergePolicy,argumentMap:{options:0}}),b.defaults("fluid.eventedComponent",{gradeNames:["fluid.littleComponent","autoInit"],events:{onCreate:null,onAttach:null,onClear:null,onDestroy:null,afterDestroy:null},mergePolicy:{listeners:b.makeMergeListenersPolicy(b.mergeListenerPolicy)}}),b.COMPONENT_OPTIONS={type:"fluid.marker",value:"COMPONENT_OPTIONS"},b.emptySubcomponent=function(a){var c=b.typeTag("fluid.emptySubcomponent");c.options=a||{},c.options.gradeNames=[c.typeName],a=b.makeArray(a);for(var d=0;d<a.length;++d)c[a[d]]=b.identity;return c},b.computeNickName=function(a){var c=b.model.parseEL(a);return c[c.length-1]},b.typeFount=function(a){var c=b.initLittleComponent("fluid.typeFount",a);return b.typeTag(c.options.targetTypeName)},b.initLittleComponent=function(a,c,d,e){var f=b.typeTag(a);d=d||{gradeNames:"fluid.littleComponent"},f.destroy=b.makeRootDestroy(f);var g=b.mergeComponentOptions(f,a,c,d),h=f.options,i=b.hasGrade(h,"fluid.eventedComponent");i&&(f.events={}),(e||b.identity)(f,h,g.strategy),b.computeDynamicComponents(f,g);for(var j=0;j<g.mergeBlocks.length;++j)g.mergeBlocks[j].initter();return g.initter(),delete h.mergePolicy,b.initLifecycleFunctions(f),b.fireEvent(h,"preInitFunction",f),i&&(b.instantiateFirers(f,h),b.mergeListeners(f,f.events,h.listeners)),b.hasGrade(h,"autoInit")||b.clearLifecycleFunctions(h),f},b.updateWithDefaultLifecycle=function(a,c,d){var e=d+"."+a.substring(0,a.length-"function".length),f=b.getGlobalValue(e);if("function"==typeof f){c=b.makeArray(c);var g=b.find(c,function(a){var b=a.listener||a;return b===f||b===e?!0:void 0});g||c.push(f)}return c},b.initLifecycleFunctions=function(a){var c=a.options.gradeNames||[];b.each(b.lifecycleFunctions,function(d,e){for(var f=a.options[e],g=c.length-1;g>=0;--g)"autoInit"!==c[g]&&(f=b.updateWithDefaultLifecycle(e,f,c[g]));f&&(a.options[e]=b.makeEventFirer({name:e,ownerId:a.id}),b.event.addListenerToFirer(a.options[e],f))})},b.clearLifecycleFunctions=function(a){b.each(b.lifecycleFunctions,function(b,c){delete a[c]}),delete a.initFunction},b.diagnoseFailedView=b.identity,b.makeRootDestroy=function(a){return function(){b.fireEvent(a,"events.onClear",[a,"",null]),b.doDestroy(a),b.fireEvent(a,"events.afterDestroy",[a,"",null])}},b.isDestroyed=function(a){return a.destroy===b.destroyedMarker},b.doDestroy=function(a,c,d){b.fireEvent(a,"events.onDestroy",[a,c||"",d]),a.destroy=b.destroyedMarker;for(var e in a.events)"afterDestroy"!==e&&"function"==typeof a.events[e].destroy&&a.events[e].destroy();a.applier&&a.applier.destroy()},b.resolveReturnedPath=b.identity,b.initComponent=function(a,c){var d=b.defaults(a);d.gradeNames||b.fail("Cannot initialise component "+a+" which has no gradeName registered");var e,f=[a].concat(b.makeArray(c));return b.pushActivity("initComponent","constructing component of type %componentName with arguments %initArgs",{componentName:a,initArgs:c}),e=b.invokeGlobalFunction(d.initFunction,f),b.diagnoseFailedView(a,e,d,f),b.fireEvent(e.options,"postInitFunction",e),b.initDependents&&b.initDependents(e),b.fireEvent(e.options,"finalInitFunction",e),b.clearLifecycleFunctions(e.options),b.fireEvent(e,"events.onCreate",e),b.popActivity(),b.resolveReturnedPath(e.options.returnedPath,e)?b.get(e,e.options.returnedPath):e},b.initSubcomponentImpl=function(a,c,d){var e;if("function"!=typeof c){var f="string"==typeof c?c:c.type;e="fluid.emptySubcomponent"===f?b.emptySubcomponent(c.options):b.invokeGlobalFunction(f,d)}else e=c.apply(null,d);return e},b.initSubcomponents=function(a,c,d){var e=a.options[c];if(e){var f=b.makeArray(e),g=-1,h=[];d=b.makeArray(d);for(var i=0;i<d.length;++i)d[i]===b.COMPONENT_OPTIONS&&(g=i);for(i=0;i<f.length;++i)e=f[i],-1!==g&&(d[g]=e.options),h[i]=b.initSubcomponentImpl(a,e,d);return h}},b.initSubcomponent=function(a,c,d){return b.initSubcomponents(a,c,d)[0]};var r="(?:[\\w\\u00c0-\\uFFFF*_-";b.simpleCSSMatcher={regexp:new RegExp("([#.]?)("+r+"]|\\\\.)+)","g"),charToTag:{"":"tag","#":"id",".":"clazz"}},b.IoCSSMatcher={regexp:new RegExp("([&#]?)("+r+"]|\\.)+)","g"),charToTag:{"":"context","&":"context","#":"id"}};var s=new RegExp("\\s*(>)?\\s*","g");b.parseSelector=function(c,d){var e=[];c=a.trim(c);var f=d.regexp;f.lastIndex=0;for(var g=0;;){for(var h=[],i=!0;;){var j=f.exec(c);if(!j)break;if(j.index!==g){if(!i)break;b.fail("Error in selector string - cannot match child selector expression starting at "+c.substring(g))}var k={},l=j[2],m=d.charToTag[j[1]];m&&(k[m]=l),h[h.length]=k,g=f.lastIndex,i=!1}s.lastIndex=g;var n={predList:h},o=s.exec(c);if(o&&o.index===g||b.fail("Error in selector string - can not match child selector expression at "+c.substring(g)),">"===o[1]&&(n.child=!0),e[e.length]=n,s.lastIndex>=c.length)break;g=s.lastIndex,f.lastIndex=s.lastIndex}return e},b.stringToRegExp=function(a,b){return new RegExp(a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),b)},b.stringTemplate=function(a,c){var d=b.keys(c);d=d.sort(b.compareStringLength());for(var e=0;e<d.length;++e){var f=d[e],g=b.stringToRegExp("%"+f,"g");a=a.replace(g,c[f])}return a},b.defaults("fluid.messageResolver",{gradeNames:["fluid.littleComponent","autoInit"],mergePolicy:{messageBase:"nomerge",parents:"nomerge"},resolveFunc:b.stringTemplate,parseFunc:b.identity,messageBase:{},
parents:[]}),b.messageResolver.preInit=function(a){a.messageBase=a.options.parseFunc(a.options.messageBase),a.lookup=function(c){var d=b.messageResolver.resolveOne(a.messageBase,c);return void 0===d?b.find(a.options.parents,function(a){return a?a.lookup(c):void 0}):{template:d,resolveFunc:a.options.resolveFunc}},a.resolve=function(c,d){if(!c)return"[No messagecodes provided]";c=b.makeArray(c);var e=a.lookup(c);return e?e.resolveFunc(e.template,d):"[Message string for key "+c[0]+" not found]"}},b.messageResolver.resolveOne=function(a,b){for(var c=0;c<b.length;++c){var d=b[c],e=a[d];if(void 0!==e)return e}},b.messageLocator=function(a,c){var d=b.messageResolver({messageBase:a,resolveFunc:c});return function(a,b){return d.resolve(a,b)}}}(jQuery,fluid_2_0);var fluid_2_0=fluid_2_0||{},fluid=fluid||fluid_2_0;!function(a,b){"use strict";function c(d,e,f){var g,h=e+f.indentChars,i="function"==typeof d;if(null===d)g="null";else if(void 0===d)g="undefined";else if(d===b.SYNTHETIC_PROPERTY)g="[Synthetic property]";else if(b.isPrimitive(d)&&!i)g=JSON.stringify(d);else{if(-1!==a.inArray(d,f.stack))return"(CIRCULAR)";f.stack.push(d);var j,k=[];if(b.isArrayable(d))if(0===d.length)g="[]";else{for(j=0;j<d.length;++j)k[j]=c(d[j],h,f);g="[\n"+h+k.join(",\n"+h)+"\n"+e+"]"}else{j=0,g="{"+(i?" Function":"")+"\n";for(var l in d){var m=b.getSafeProperty(d,l);k[j++]=JSON.stringify(l)+": "+c(m,h,f)}g+=h+k.join(",\n"+h)+"\n"+e+"}"}f.stack.pop()}return g}b.renderTimestamp=function(a){var b=function(a,b){b||(b=2);var c=void 0===a?"":a.toString();return"00000".substring(5-b+c.length)+c};return b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+"."+b(a.getMilliseconds(),3)},b.isTracing=!1,b.registerNamespace("fluid.tracing"),b.tracing.pathCount=[],b.tracing.summarisePathCount=function(a){a=a||b.tracing.pathCount;for(var c={},d=0;d<a.length;++d){var e=a[d];c[e]?++c[e]:c[e]=1}var f=[];return b.each(c,function(a,b){f.push({path:b,count:a})}),f.sort(function(a,b){return b.count-a.count}),f},b.tracing.condensePathCount=function(a,c){a=b.makeArray(a);var d={};b.each(a,function(a){d[a]=0});var e=[];return b.each(c,function(c){var f=c.path;b.find(a,function(a){return 0===f.indexOf(a)?(d[a]+=c.count,!0):void 0})||e.push(c)}),b.each(d,function(a,b){e.unshift({path:b,count:a})}),e},b.detectStackStyle=function(a){var b="other",c={offset:0};return a.arguments?b="chrome":"undefined"!=typeof window&&window.opera&&a.stacktrace?b="opera10":a.stack?(b="firefox",c.offset=-1===a.stack.indexOf("Trace exception")?1:0):"undefined"==typeof window||!window.opera||"stacktrace"in a||(b="opera"),c.style=b,c},b.obtainException=function(){try{throw new Error("Trace exception")}catch(a){return a}};var d=b.detectStackStyle(b.obtainException());b.registerNamespace("fluid.exceptionDecoders"),b.decodeStack=function(){if("firefox"!==d.style)return null;var a=b.obtainException();return b.exceptionDecoders[d.style](a)},b.exceptionDecoders.firefox=function(a){var c=a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n");return b.transform(c,function(a){var b=a.indexOf("@");return-1===b?[a]:[a.substring(b+1),a.substring(0,b)]})},b.getCallerInfo=function(a){a=(a||3)-d.offset;var c=b.decodeStack();return c?c[a][0]:null},b.generatePadding=function(a,b){for(var c="",d=0;b>d;++d)c+=a;return c},b.SYNTHETIC_PROPERTY={},b.getSafeProperty=function(a,c){var d=Object.getOwnPropertyDescriptor(a,c);return d&&!d.get?a[c]:b.SYNTHETIC_PROPERTY},b.prettyPrintJSON=function(d,e){return e=a.extend({indent:4,stack:[]},e),e.indentChars=b.generatePadding(" ",e.indent),c(d,"",e)},b.dumpEl=function(c){var d;if(!c)return"null";if(3===c.nodeType||8===c.nodeType)return"[data: "+c.data+"]";if(9===c.nodeType)return"[document: location "+c.location+"]";if(!c.nodeType&&b.isArrayable(c)){d="[";for(var e=0;e<c.length;++e)d+=b.dumpEl(c[e]),e<c.length-1&&(d+=", ");return d+"]"}return c=a(c),d=c.get(0).tagName,c.id&&(d+="#"+c.id),c.attr("class")&&(d+="."+c.attr("class")),d}}(jQuery,fluid_2_0);var fluid_2_0=fluid_2_0||{};!function(a,b){"use strict";function c(a,b){var c=j[a]||[];a:for(var d=0;d<c.length;++d){for(var e=c[d],f=0;f<b.length;++f)if(e.contexts[f]!==b[f])continue a;return e.spec}}function d(a,c,d,e){for(var f=0;d>f;++f)a=e(a,c[f],f,b.makeArray(c));return a}b.visitComponentChildren=function(a,c,d,e,f){var g=b.getInstantiator(a);for(var h in a){var i=g.composePath(e,h),j=a[h];if(!(!b.isComponent(j)||d.visited&&d.visited[j.id])){if(d.visited&&(d.visited[j.id]=!0),c(j,h,i,e,f))return!0;d.flat||b.visitComponentChildren(j,c,d,i)}}},b.getMemberNames=function(a,c){var d=a.idToPath(c[c.length-1].id),e=b.model.parseEL(d);return e.unshift.apply(e,b.generate(c.length-e.length,"")),e};var e=function(a,c,d,e){e=e||{visited:{},flat:!0,instantiator:a};for(var f=b.getMemberNames(a,c),g=c.length-1;g>=0;--g){var h,i=c[g];if(i.typeName&&(e.visited[i.id]=!0,h=a.idToPath[i.id],d(i,f[g],h,h,g)))return;if(b.visitComponentChildren(i,d,e,h,g))return}};b.mountStrategy=function(a,b,c){var d=a.length;return function(b,e,f,g){if(!(f<=a.length)){for(var h=0;h<a.length;++h)if(g[h]!==a[h])return;return c(b,e,f-a.length,g.slice(d))}}},b.invokerFromRecord=function(a,c,d){b.pushActivity("makeInvoker","beginning instantiation of invoker with name %name and record %record as child of %that",{name:c,record:a,that:d});var e=b.makeInvoker(d,a,c);return b.popActivity(),e},b.memberFromRecord=function(a,c,d){var e=b.expandOptions(a,d,null,null,{freeRoot:!0});return e},b.recordStrategy=function(a,c,d,e,f,g){return g=g||[],{strategy:function(g,h,i){if(1===i){var j=b.driveStrategy(c,[e,h],d);if(void 0!==j){b.set(g,[h],b.inEvaluationMarker);var k=f(j,h,a);return b.set(g,[h],k),k}}},initter:function(){var f=b.driveStrategy(c,e,d)||{};for(var h in f)b.getForComponent(a,g.concat([h]))}}},b.instantiateFirers=function(a){var c=b.shadowForComponent(a),d=b.get(c,["eventStrategyBlock","initter"])||b.identity;d()},b.makeDistributionRecord=function(c,d,e,f,g,h,i){h=h||0,i=i||"distribution";var j=b.copy(b.get(d,e));b.each(g,function(a){b.model.applyChangeRequest(j,{path:a,type:"DELETE"})});var k={options:{}},l=b.isPrimitive(j);return b.model.applyChangeRequest(k,{path:f,type:l?"ADD":"MERGE",value:j}),a.extend(k,{contextThat:c,recordType:i,priority:b.mergeRecordTypes.distribution+h})},b.filterBlocks=function(c,d,e,f,g,h){var i=[],j=0;return b.each(d,function(d){var k=b.get(d.source,e);if(k){i.push(b.makeDistributionRecord(c,d.source,e,f,g,j++,d.recordType));var l=a.extend({},k);h&&b.model.applyChangeRequest(d.source,{path:e,type:"DELETE"}),b.each(g,function(a){var c=b.get(l,a);b.set(d.source,e.concat(a),c)})}}),i},b.matchIoCSelector=function(a,b,c,d,e){for(var f=b.length-1,g=a.length-1;;){for(var h=f===b.length-1||a[g].child,i=b[f],j=a[g],k=!0,l=0;l<j.predList.length;++l){var m=j.predList[l];if(m.context&&!c[f][m.context]&&d[f]!==m.context){k=!1;break}if(m.id&&i.id!==m.id){k=!1;break}}if(0===g&&f>e&&h&&(k=!1),k){if(0===g)return!0;--f,--g}else{if(h)return!1;--f}if(e>f)return!1}},b.noteCollectedDistribution=function(a,c,d){b.model.setSimple(a,["collectedDistributions",c,d.id],!0)},b.isCollectedDistribution=function(a,c,d){return b.model.getSimple(a,["collectedDistributions",c,d.id])},b.clearCollectedDistributions=function(a,c){b.model.applyChangeRequest(a,{path:["collectedDistributions",c],type:"DELETE"})},b.collectDistributions=function(a,c,d,e,f,g,h){var i=g[g.length-1];!b.isCollectedDistribution(c,i,d)&&b.matchIoCSelector(d.selector,e,f,g,h)&&(a.push.apply(a,d.blocks),b.noteCollectedDistribution(c,i,d))},b.registerCollectedClearer=function(a,c,d){!a.collectedClearer&&c&&(a.collectedClearer=function(){b.clearCollectedDistributions(c,d)})},b.receiveDistributions=function(a,c,d,e){var f=b.getInstantiator(a||e),g=f.getThatStack(a||e),h=b.getMemberNames(f,g),i=[],j=b.transform(g,function(a){return f.idToShadow[a.id]}),k=j[j.length-(a?1:2)],l=b.getMembers(j,"contextHash");a?(h.push(d),l.push(b.gradeNamesToHash(c)),g.push(e)):b.registerCollectedClearer(j[j.length-1],k,h[h.length-1]);for(var m=0;m<g.length-1;++m)b.each(j[m].distributions,function(a){b.collectDistributions(i,k,a,g,l,h,m)});return i},b.applyDistributions=function(a,c,d){var e=b.transform(c,function(c){return b.generateExpandBlock(c,a,d.mergePolicy)}),f=d.mergeOptions;return f.mergeBlocks.push.apply(f.mergeBlocks,e),f.updateBlocks(),e},b.parseExpectedOptionsPath=function(a,c){var d=b.model.parseEL(a);return d.length>1&&"options"!==d[0]&&b.fail("Error in options distribution path ",a," - only "+c+' paths beginning with "options" are supported'),d.slice(1)},b.isIoCSSSelector=function(a){return-1!==a.indexOf(" ")},b.pushDistributions=function(a,c,d){var e=b.shadowForComponent(a),f=b.allocateGuid(),g=e.distributions=e.distributions||[];return g.push({id:f,selector:c,blocks:d}),f},b.clearDistributions=function(a,c){var d=b.shadowForComponent(a);b.remove_if(d.distributions,function(a){return a.id===c})},b.extractSelectorHead=function(a){var b=a[0].predList,c=b[0].context;return b.length=0,c},b.undistributableOptions=["gradeNames","distributeOptions","returnedPath","argumentMap","initFunction","mergePolicy","progressiveCheckerOptions"],b.distributeOptions=function(a,c){var d=b.makeArray(b.driveStrategy(a.options,"distributeOptions",c));b.each(d,function(c){var d,e,f=b.parseContextReference(c.target);if(b.isIoCSSSelector(f.context)){e=b.parseSelector(f.context,b.IoCSSMatcher);var g=b.extractSelectorHead(e);"that"!==g&&b.fail('Downwards options distribution not supported from component other than "that"'),d=a}else d=b.resolveContext(f.context,a),d||b.fail("Error in options distribution record ",c," - could not resolve context selector {"+f.context+"} to a root component");var h,i=b.model.parseEL(f.path);if(void 0!==c.record)h=[b.makeDistributionRecord(a,c.record,[],i,[],0)];else{var j=b.shadowForComponent(a),k=b.parseContextReference(c.source||"{that}.options");"that"!==k.context&&b.fail("Error in options distribution record ",c," only a context of {that} is supported");var l=b.parseExpectedOptionsPath(k.path,"source"),m=b.makeArray(c.exclusions).concat(0===l.length?b.undistributableOptions:[]),n=b.transform(m,function(a){return b.model.parseEL(a)});h=b.filterBlocks(a,j.mergeOptions.mergeBlocks,l,i,n,c.removeSource),j.mergeOptions.updateBlocks()}if(e)b.pushDistributions(d,e,h);else{var o=b.shadowForComponent(d);b.applyDistributions(a,h,o)}})},b.gradeNamesToHash=function(a){var c={};return b.each(a,function(a){c[a]=!0,c[b.computeNickName(a)]=!0}),c},b.cacheShadowGrades=function(a,c){var d=b.gradeNamesToHash(a.options.gradeNames);d[a.nickName]=!0,c.contextHash=d},b.deliverOptionsStrategy=function(a,c,d){var e=b.shadowForComponent(a,e);b.cacheShadowGrades(a,e),e.mergeOptions=d},b.resolveReturnedPath=function(a,c){var d=b.shadowForComponent(c);return d&&""!==d.path?null:a},b.defaults("fluid.gradeLinkageRecord",{gradeNames:["fluid.littleComponent"]}),b.defaults("fluid.applyGradeLinkage",{}),b.gradeLinkageIndexer=function(a){return a.contextGrades&&a.resultGrades?["*"]:void 0},b.getLinkedGrades=function(a){var c=[],d=b.indexDefaults("gradeLinkages",{gradeNames:"fluid.gradeLinkageRecord",indexFunc:b.gradeLinkageIndexer});return b.each(d["*"],function(d){var e=b.defaults(d),f=b.find(b.makeArray(e.contextGrades),function(c){return b.contains(a,c)?void 0:!0});f||c.push.apply(c,b.makeArray(e.resultGrades))}),c},b.expandDynamicGrades=function(a,c,d,e){var f=[];b.each(e,function(c){var d=b.expandOptions(c,a);"function"==typeof d&&(d=d()),d&&(f=f.concat(d))});var g=b.makeArray(d).concat(f);if(b.contains(g,"fluid.applyGradeLinkage")){var h=b.getLinkedGrades(g);b.remove_if(h,function(a){return b.contains(g,a)}),f=f.concat(h)}var i=b.receiveDistributions(null,null,null,a);if(i.length>0){var j=b.applyDistributions(a,i,c),k=b.transform(b.getMembers(j,["source","gradeNames"]),b.makeArray);f=f.concat.apply(f,k)}return f},b.collectDynamicGrades=function(a,c,d,e,f,g){var h=b.copy(b.getGradedDefaults(a.typeName,g));e.length=0,e.push.apply(e,h.gradeNames),b.cacheShadowGrades(a,c),c.mergeOptions.destroyValue("mergePolicy"),c.mergeOptions.destroyValue("components"),c.mergeOptions.destroyValue("invokers"),d.source=h,c.mergeOptions.updateBlocks();var i=b.remove_if(e,function(a){return"{"===a.charAt(0)&&!b.contains(f,a)},[]);return f.push.apply(f,i),i=b.expandDynamicGrades(a,c,e,i),g.push.apply(g,i),i},b.computeDynamicGrades=function(a,c,d){delete a.options.gradeNames;var e=b.driveStrategy(a.options,"gradeNames",d),f=b.findMergeBlocks(c.mergeOptions.mergeBlocks,"defaults")[0],g=b.remove_if(e,function(a){return"{"===a.charAt(0)||!b.hasGrade(f.target,a)},[]),h=b.expandDynamicGrades(a,c,e,g);if(0!==h.length){var i;do i=b.collectDynamicGrades(a,c,f,e,g,h);while(0!==i.length)}c.collectedClearer&&(c.collectedClearer(),delete c.collectedClearer)},b.computeDynamicComponentKey=function(a,b){return a+(0===b?"":"-"+b)},b.registerDynamicRecord=function(a,c,d,e,f){var g=b.computeDynamicComponentKey(c,d),h=b.copy(e);return delete h[f],b.set(a.options,["components",g],h),g},b.computeDynamicComponents=function(a,c){var d=b.shadowForComponent(a),e=d.subcomponentLocal={},f=b.driveStrategy(a.options,"dynamicComponents",c.strategy);b.each(f,function(c,f){if(c.sources||c.createOnEvent||b.fail("Cannot process dynamicComponents record ",c,' without a "sources" or "createOnEvent" entry'),c.sources){var g=b.expandOptions(c.sources,a);b.each(g,function(d,g){var h=b.registerDynamicRecord(a,f,g,c,"sources");e[h]={source:d,sourcePath:g}})}else if(c.createOnEvent){var h=b.event.expandOneEvent(a,c.createOnEvent);b.set(d,["dynamicComponentCount",f],0);var i=function(){var g=b.registerDynamicRecord(a,f,d.dynamicComponentCount[f]++,c,"createOnEvent");e[g]={arguments:b.makeArray(arguments)},b.initDependent(a,g)};h.addListener(i),b.recordListener(h,i,d)}})},b.computeComponentAccessor=function(a){var c=b.shadowForComponent(a),d=a.options,e=c.mergeOptions.strategy,f=b.mountStrategy(["options"],d,e);c.invokerStrategy=b.recordStrategy(a,d,e,"invokers",b.invokerFromRecord),c.eventStrategyBlock=b.recordStrategy(a,d,e,"events",b.eventFromRecord,["events"]);var g=b.mountStrategy(["events"],a,c.eventStrategyBlock.strategy,["events"]);return c.memberStrategy=b.recordStrategy(a,d,e,"members",b.memberFromRecord),c.getConfig={strategies:[b.model.funcResolverStrategy,b.makeGingerStrategy(a),f,c.invokerStrategy.strategy,c.memberStrategy.strategy,g]},b.computeDynamicGrades(a,c,e,c.mergeOptions.mergeBlocks),b.distributeOptions(a,e),c.getConfig},b.shadowForComponent=function(a){var c=b.getInstantiator(a);return c&&a?c.idToShadow[a.id]:null},b.getForComponent=function(a,c){var d=b.shadowForComponent(a),e=d?d.getConfig:void 0;return b.get(a,c,e)},b.makeGingerStrategy=function(a){var c=b.getInstantiator(a);return function(a,d,e,f){var g=a[d];if(g===b.inEvaluationMarker&&e===f.length&&b.fail('Error in component configuration - a circular reference was found during evaluation of path segment "'+d+'": for more details, see the activity records following this message in the console, or issue fluid.setLogging(fluid.logLevel.TRACE) when running your application'),e>1)return g;if(void 0===g&&a.hasOwnProperty(d))return b.NO_VALUE;if(void 0===g){var h=c.idToShadow[a.id].path,i=b.composePath(h,d);g=c.pathToComponent[i]}if(void 0===g){var j=b.getForComponent(a,["options","components",d]);j&&(j.createOnEvent&&b.fail('Error resolving path segment "'+d+'" of path '+f.join(".")+" since component with record ",j,' has annotation "createOnEvent" - this very likely represents an implementation error. Either alter the reference so it does not  match this component, or alter your workflow to ensure that the component is instantiated by the time this reference resolves'),b.initDependent(a,d),g=a[d])}return g}},b.filterBuiltinGrades=function(a){return b.remove_if(b.makeArray(a),function(a){return/^(autoInit|fluid.littleComponent|fluid.modelComponent|fluid.eventedComponent|fluid.viewComponent|fluid.typeFount)$/.test(a)})},b.dumpGradeNames=function(a){return a.options&&a.options.gradeNames?" gradeNames: "+JSON.stringify(b.filterBuiltinGrades(a.options.gradeNames)):""},b.dumpThat=function(a){return'{ typeName: "'+a.typeName+'"'+b.dumpGradeNames(a)+" id: "+a.id+"}"},b.dumpThatStack=function(a,c){var d=b.transform(a,function(a){var d=c.idToPath(a.id);return b.dumpThat(a)+(d?" - path: "+d:"")});return d.join("\n")},b.resolveContext=function(a,c){var d=b.getInstantiator(c);if("instantiator"===a)return d;if("that"===a)return c;var f,g=d.getFullStack(c);return e(d,g,function(c,d){var e=b.shadowForComponent(c);return a===d||e&&e.contextHash&&e.contextHash[a]||a===c.typeName||a===c.nickName?(f=c,!0):b.getForComponent(c,["options","components",a,"type"])&&!c[a]?(f=b.getForComponent(c,a),!0):void 0}),f};var f=/^(arguments|options|container|source|sourcePath|change)$/;b.makeStackFetcher=function(a,c){var d=function(d){a&&a.destroy===b.destroyedMarker&&b.fail("Cannot resolve reference "+b.renderContextReference(d)+" from component "+b.dumpThat(a)+" which has been destroyed");var e=d.context;if(c&&f.test(e)){var g=b.get(c[e],d.path);return"arguments"===e||"source"===e||"sourcePath"===e||"change"===e?g:{marker:"options"===e?b.EXPAND:b.EXPAND_NOW,value:g}}var h=b.resolveContext(e,a);if(!h&&""!==d.path){var i=b.renderContextReference(d);b.fail("Failed to resolve reference "+i+" - could not match context with name "+e+" from component "+b.dumpThat(a),a)}return b.getForComponent(h,d.path)};return d},b.makeStackResolverOptions=function(c,d){return a.extend(b.copy(b.rawDefaults("fluid.makeExpandOptions")),{fetcher:b.makeStackFetcher(c,d),contextThat:c})},b.clearListeners=function(a){b.each(a.listeners,function(a){a.event.removeListener(a.listener)}),delete a.listeners},b.recordListener=function(a,b,c){if(a.ownerId!==c.that.id){var d=c.listeners;d||(d=c.listeners=[]),d.push({event:a,listener:b})}};var g={};b.instantiator=function(a){function c(a,c,e){if(e){g[a.id]=d;var f=d.idToShadow[a.id]={};f.that=a,f.path=c}d.pathToComponent[c]&&b.fail("Error during instantiation - path "+c+" which has just created component "+b.dumpThat(a)+" has already been used for component "+b.dumpThat(d.pathToComponent[c])+" - this is a circular instantiation or other oversight. Please clear the component using instantiator.clearComponent() before reusing the path."),d.pathToComponent[c]=a}var d={id:b.allocateGuid(),free:a,nickName:"instantiator",pathToComponent:{},idToShadow:{},modelTransactions:{init:{}},composePath:b.composePath};return d.idToPath=function(a){var b=d.idToShadow[a];return b?b.path:""},d.getThatStack=function(a){var c=d.idToShadow[a.id];if(c){var e=c.path,f=b.model.parseEL(e),g=b.transform(f,function(a,c){var e=b.model.composeSegments.apply(null,f.slice(0,c+1));return d.pathToComponent[e]}),h=d.pathToComponent[""];return h&&g.unshift(h),g}return[a]},d.getEnvironmentalStack=function(){var c=[b.staticEnvironment];return a||c.push(b.globalThreadLocal()),c},d.getFullStack=function(a){var b=a?d.getThatStack(a):[];return d.getEnvironmentalStack().concat(b)},d.recordRoot=function(a){a&&a.id&&!d.pathToComponent[""]&&c(a,"",!0)},d.recordKnownComponent=function(a,b,e,f){var g=d.idToShadow[a.id].path,h=d.composePath(g,e);c(b,h,f)},d.clearComponent=function(a,c,e,f,h,i){var j=d.idToShadow[a.id].path;f=f||{flat:!0,instantiator:d},e=e||a[c],i=i||j,void 0===i&&b.fail("Cannot clear component "+c+" from component ",a," which was not created by this instantiator"),b.fireEvent(e,"events.onClear",[e,c,a]);var k=d.composePath(i,c),l=d.idToShadow[e.id];l&&l.path===k&&(b.doDestroy(e,c,a),b.clearListeners(l),b.visitComponentChildren(e,function(a,b,c,g){d.clearComponent(e,b,null,f,!0,g)},f,k),b.fireEvent(e,"events.afterDestroy",[e,c,a]),delete d.idToShadow[e.id],delete g[e.id]),delete d.pathToComponent[k],h||delete a[c]},d},b.freeInstantiator=b.instantiator(!0),b.getInstantiator=function(a){return a&&g[a.id]||b.freeInstantiator},b.expandOptions=function(a,c,d,e,f){if(!a)return a;b.pushActivity("expandOptions","expanding options %args for component %that ",{that:c,args:a});var g=b.makeStackResolverOptions(c,e);g.mergePolicy=d,g.freeRoot=f&&f.freeRoot;var h=f&&f.defer?b.makeExpandOptions(a,g):b.expand(a,g);return b.popActivity(),h},b.localRecordExpected=["type","options","args","mergeOptions","createOnEvent","priority","recordType"],b.checkComponentRecord=function(a,c){var d=b.arrayToHash(b.localRecordExpected);b.each(a&&a.argumentMap,function(a,b){d[b]=!0}),b.each(c,function(a,c){d[c]||b.fail('Probable error in subcomponent record - key "'+c+'" found, where the only legal options are '+b.keys(d).join(", "))})},b.pushDemands=function(a,c){function d(b){b.recordType="demands",b.priority=f++,a.push(b)}function e(a){d({options:a})}c=b.makeArray(c);for(var f=b.mergeRecordTypes.demands,g=0;g<c.length;++g){var h=c[g];if(h.options)d(h);else if(h.mergeOptions){var i=b.makeArray(h.mergeOptions);b.each(i,e)}else b.fail("Uninterpretable demands record without options or mergeOptions ",h)}},b.mergeRecordsToList=function(a){var c=[];return b.each(a,function(a,d){if(a.recordType=d,"distributions"===d)c.push.apply(c,a);else if("demands"!==d){if(!a.options)return;a.priority=b.mergeRecordTypes[d],void 0===a.priority&&b.fail("Merge record with unrecognised type "+d+": ",a),c.push(a)}else b.pushDemands(c,a)}),c};var h=function(a){return b.each(["gradeNames","mergePolicy","argumentMap","components","dynamicComponents","members","invokers","events","listeners","modelListeners","distributeOptions","transformOptions"],function(c){b.set(a,[c,"*","noexpand"],!0)}),a};b.generateExpandBlock=function(a,c,d,e){var f=b.expandOptions(a.options,a.contextThat||c,d,e,{defer:!0});return f.priority=a.priority,f.recordType=a.recordType,f};var i=function(c,d,e,f){var g=b.copy(d);h(c);var i=b.shadowForComponent(f);i.mergePolicy=c;var j={defaults:{options:g}};e&&(e.marker===b.EXPAND?(a.extend(j,e.mergeRecords),j.subcomponentRecord&&b.checkComponentRecord(d,j.subcomponentRecord)):j.user={options:b.expandCompact(e,!0)});var k=b.mergeRecordsToList(j),l=b.transform(k,function(a){return b.generateExpandBlock(a,f,c,e&&e.localRecord)});return l};b.makeIoCRootDestroy=function(a,b){return function(){a.clearComponent(b,"",b,null,!0)}},b.fabricateDestroyMethod=function(a,b,c,d){return function(){c.clearComponent(a,b,d)}},b.expandComponentOptions=function(a,c,d,e){var f,g=d&&d.marker===b.EXPAND&&void 0!==d.memberName?d.instantiator:null;g||(g=b.instantiator(),f=!0,b.log("Created new instantiator with id "+g.id+" in order to operate on component "+(e?e.typeName:"[none]")),e.destroy=b.makeIoCRootDestroy(g,e)),b.pushActivity("expandComponentOptions","expanding component options %options with record %record for component %that",{options:d&&d.mergeRecords,record:d,that:e}),f?g.recordRoot(e):g.recordKnownComponent(d.parentThat,e,d.memberName,!0);var h=i(a,c,d,e);return b.popActivity(),h},b.argMapToDemands=function(a){var c=[];return b.each(a,function(a,b){c[a]="{"+b+"}"}),c},b.makePassArgsSpec=function(a){return b.transform(a,function(a,b){return"{arguments}."+b})},b.pushDemandSpec=function(a,b,c){b&&"{options}"!==b&&a.push({options:b}),c&&a.push({mergeOptions:c})},b.embodyDemands=function(c,d,e,f){f=f||{},d.mergeOptions&&d.options&&b.fail("demandspec ",d," is invalid - cannot specify literal options together with mergeOptions"),d.transformOptions&&(d.options=a.extend(!0,{},d.options,{transformOptions:d.transformOptions}));var g=b.makeArray(d.args),h=b.defaults(d.funcName),i={},j=h&&c?b.receiveDistributions(c,h.gradeNames,f.memberName,i):[],k=h?h.argumentMap:null,l=!1;if(h&&(f.passArgs=!1),!k&&(h||f&&f.componentRecord))if(l=!0,g.length<2)k=b.rawDefaults("fluid.littleComponent").argumentMap;else{var m=a.inArray("{options}",g);-1===m&&(m=g.length-1),k={options:m}}f=f||{},0===g.length&&(k?g=b.argMapToDemands(k):f.passArgs&&(g=b.makePassArgsSpec(e)));var n=b.shadowForComponent(c),o=n&&f.memberName?n.subcomponentLocal[f.memberName]:null,p=a.extend({arguments:e},b.censorKeys(f.componentRecord,["type"]),o);b.each(k,function(a,b){if(e.length>0&&(p[b]=p.arguments[a]),void 0!==d[b]&&void 0===p[b]&&(p[b]=d[b]),"options"!==b)for(var c=0;c<j.length;++c)void 0!==j[c][b]&&(p[b]=j[c][b])});var q;for(q=0;q<j.length;++q)void 0!==j[q].type&&(d.funcName=j[q].type);var r={distributions:j};void 0!==f.componentRecord&&(r.subcomponentRecord=a.extend({},f.componentRecord));var s=b.makeStackResolverOptions(c,p),t=function(a){b.pushDemandSpec(r.demands,a.options,a.mergeOptions)},u=[];if(g)for(q=0;q<g.length;++q){var v=g[q];if(b.isMarker(v)&&v.value===b.COMPONENT_OPTIONS.value&&(v="{options}",l&&(k={options:q})),"string"==typeof v&&"@"===v.charAt(0)){var w=v.substring(1);v="{arguments}."+w}g[q]=v,k&&k.options===q?(f.passArgs&&b.fail("Error invoking function "+d.funcName+": found component creator rather than free function"),"object"!=typeof v||v.targetTypeName||(v.targetTypeName=d.funcName),r.demands=[],b.each(d.backSpecs.reverse(),t),b.pushDemandSpec(r.demands,d.options||v,d.mergeOptions),e.length>0&&(r.user={options:p.options}),u[q]={marker:b.EXPAND,localRecord:o,mergeRecords:r,instantiator:b.getInstantiator(c),parentThat:c,memberName:f.memberName}):u[q]=b.expand(v,s),u[q]&&b.isMarker(u[q].marker,b.EXPAND_NOW)&&(u[q]=b.expand(u[q].value,s))}else u=e?e:[];var x={args:u,preExpand:g,funcName:d.funcName};return x},b.initDependent=function(a,c,d){if(!a[c]){d=d||[];var e=a.options.components[c];b.pushActivity("initDependent",'instantiating dependent component with name "%name" with record %record as child of %parent',{name:c,record:e,parent:a});var f,h=g[a.id];if("string"==typeof e)f=b.expandOptions(e,a),h.recordKnownComponent(a,f,c,!1);else if(e.type){var i=b.expandOptions(e.type,a);i||b.fail("Error in subcomponent record: ",e.type," could not be resolved to a type for component ",c," of parent ",a);var j=b.resolveDemands(a,[i,c],d,{componentRecord:e,memberName:c});f=b.initSubcomponentImpl(a,{type:j.funcName},j.args);var k=h.composePath(h.idToPath(a.id),c),l=h.pathToComponent[k];l&&l!==f&&h.clearComponent(a,c,l),f&&f.typeName&&f.id&&f!==l&&h.recordKnownComponent(a,f,c,!0),f.destroy=b.fabricateDestroyMethod(a,c,h,f)}else b.fail("Unrecognised material in place of subcomponent "+c+' - no "type" field found');return a[c]=f,b.fireEvent(f,"events.onAttach",[f,c,a]),b.popActivity(),f}},b.bindDeferredComponent=function(a,c,d){var e=b.makeArray(d.createOnEvent);b.each(e,function(e){var f="{"===e.charAt(0)?b.expandOptions(e,a):a.events[e];f&&f.addListener||b.fail("Error instantiating createOnEvent component with name "+c+" of parent ",a," since event specification "+e+" could not be expanded to an event - got ",f),f.addListener(function(){if(b.pushActivity("initDeferred","instantiating deferred component %componentName of parent %that due to event %eventName",{componentName:c,that:a,eventName:e}),a[c]){var d=g[a.id];d.clearComponent(a,c)}b.initDependent(a,c),b.popActivity()},null,null,d.priority)})},b.priorityForComponent=function(a){return a.priority?a.priority:"fluid.typeFount"===a.type||b.hasGrade(b.defaults(a.type),"fluid.typeFount")?"first":void 0},b.initDependents=function(a){b.pushActivity("initDependents","instantiating dependent components for component %that",{that:a});var c=b.shadowForComponent(a);c.memberStrategy.initter();var d=a.options,e=d.components||{},f={};b.each(e,function(c,d){if(c.createOnEvent)b.bindDeferredComponent(a,d,c);else{var e=b.priorityForComponent(c);f[d]=[{key:d,priority:b.event.mapPriority(e,0)}]}});var g=b.event.sortListeners(f);b.each(g,function(c){b.initDependent(a,c.key)}),c.invokerStrategy.initter(),b.popActivity()};var j={},k=!1;b.setDemandLogging=function(a){k=a},b.isDemandLogging=function(){return k&&b.isLogging()},b.demands=function(a,d,e){var f=b.makeArray(d).sort();if(!e)return c(a,f);if(e.length&&(e={args:e}),b.getCallerInfo&&b.isDemandLogging()){var g=b.getCallerInfo(5);g&&(e.registeredFrom=g)}e.demandId=b.allocateGuid();var h=j[a];h||(h=[],j[a]=h),h.push({contexts:f,spec:e})},b.compareDemands=function(a,b){return b.intersect-a.intersect},b.locateAllDemands=function(a,c){var d=b.isDemandLogging(c);d&&b.log("Resolving demands for function names ",c," in context of "+(a?"component "+a.typeName:"no component"));var f={},g=[],h=b.getInstantiator(a),i=h.getFullStack(a);e(h,i,function(a,c,d,e,h){f[a.typeName]=h;var i=b.makeArray(b.get(a,["options","gradeNames"]));b.each(i,function(a){f[a]=h}),g.push(a)}),d&&b.log("Components in scope for resolution:\n"+b.dumpThatStack(g,h));for(var k=[],l=0;l<c.length;++l)for(var m=j[c[l]]||[],n=0;n<m.length;++n){for(var o=m[n],p=o.spec.horizon?f[o.spec.horizon]:-1,q={spec:o,intersect:0,uncess:0},r=0;r<o.contexts.length;++r){var s=f[o.contexts[r]];q[void 0!==s&&s>=p?"intersect":"uncess"]+=2}0===o.contexts.length&&q.intersect++,0===q.uncess&&k.push(q)}return k.sort(b.compareDemands),k},b.locateDemands=function(a,c){var d=b.locateAllDemands(a,c),e=b.getMembers(d,["spec","spec"]);return b.isDemandLogging(c)&&(e.length?b.log("Located "+d.length+" potential match"+(1===d.length?"":"es")+", selected best match with "+d[0].intersect+" matched context names: ",e):b.log("No matches found for demands, using direct implementation")),e},b.determineDemands=function(c,d){d=b.makeArray(d);var e=d[0],f=b.locateDemands(c,d);return f.length&&f[0].funcName&&(e=f[0].funcName),a.extend(!0,{funcName:e,args:f[0]?b.makeArray(f[0].args):[]},{backSpecs:f.slice(1)},b.censorKeys(f[0],["funcName","args"]))},b.resolveDemands=function(a,c,d,e){var f=b.determineDemands(a,c);return b.embodyDemands(a,f,d,e)},b.thisistToApplicable=function(a,c,d){return{apply:function(e,f){var g=b.expandOptions(c,d);"string"==typeof g&&(g=b.getGlobalValue(g)),g||b.fail("Could not resolve reference "+c+" to a value");var h=g[a.method];return"function"!=typeof h&&b.fail("Object ",g," at reference "+c+" has no member named "+a.method+" which is a function "),b.log("Applying arguments ",f," to method "+a.method+" of instance ",g),h.apply(g,f)}}},b.changeToApplicable=function(a,c){return{apply:function(d,e){var f=b.parseValidModelReference(c,"changePath listener record",a.changePath),g=b.expandOptions(a.value,c,{},{arguments:e});b.fireSourcedChange(f.applier,f.path,g,a.source)}}},b.recordToApplicable=function(a,c){if(a.changePath)return b.changeToApplicable(a,c);var d=a["this"];return a.method^d&&b.fail("Record ",c,' must contain both entries "method" and "this" if it contains either'),a.method?b.thisistToApplicable(a,d,c):null},b.invoke=function(a,c,d,e){b.pushActivity("invokeFunc",'invoking function with name "%functionName" from component %that',{functionName:a,that:d});var f=b.resolveDemands(d,a,b.makeArray(c),{passArgs:!0}),g=b.invokeGlobalFunction(f.funcName,f.args,e);return b.popActivity(),g},b.makeFreeInvoker=function(a,c){var d=b.determineDemands(null,a);return function(){var a=b.embodyDemands(null,d,b.makeArray(arguments),{passArgs:!0});return b.invokeGlobalFunction(a.funcName,a.args,c)}};var l="{arguments}.";b.makeFastInvoker=function(a,c){var d;if(a.preExpand){d={};for(var e=0;e<a.preExpand.length;++e){var f=a.preExpand[e];if("string"==typeof f){if(-1!==f.indexOf("}.model"))return{noFast:!0};if("{arguments}"===f)d[e]="*";else if(0===f.indexOf(l)){var g=b.parseInteger(f.substring(l.length));if(isNaN(g))return{noFast:!0};d[e]=g}}}}var h=a.args,i=d?function(a){for(var b in d)h[b]="*"===d[b]?a:a[d[b]];return c.apply(null,h)}:function(a){return c.apply(null,a)};return{invoke:i}},b.makeInvoker=function(a,c,d,e){var f;"string"==typeof c&&("{"===c.charAt(0)?c={func:c}:f=c);var g=f?b.determineDemands(a,f):c,h={noFast:c.dynamic};return function(){b.defeatLogging===!1&&b.pushActivity("invokeInvoker","invoking invoker with name %name and record %record from component %that",{name:d,record:c,that:a});var f;if(h.invoke)f=h.invoke(arguments);else{var i=b.recordToApplicable(c,a),j=b.makeArray(arguments),k=b.embodyDemands(a,g,j,{passArgs:!0});i=i||(k.funcName?b.getGlobalValue(k.funcName,e):b.expandOptions(g.func,a)),i&&i.apply||b.fail("Error in invoker record: could not resolve members func, funcName or method to a function implementation - got "+i+" from ",g),
h.noFast!==!0&&(h=b.makeFastInvoker(k,i)),f=i.apply(null,k.args)}return b.defeatLogging===!1&&b.popActivity(),f}},b.event.makeTrackedListenerAdder=function(a){var c=b.shadowForComponent(a);return function(a){return{addListener:function(d){b.recordListener(a,d,c),a.addListener.apply(null,arguments)}}}},b.event.listenerEngine=function(a,c,d){function e(){var d=b.find(a,function(a,b){return void 0===f[b]?!0:void 0});if(!d){var e=f;f={},c(e)}}var f={};b.each(a,function(a,c){d(a).addListener(function(){f[c]=b.makeArray(arguments),e()})})},b.event.dispatchListener=function(a,c,d,e,f){var g=function(){b.pushActivity("dispatchListener","firing to listener to event named %eventName of component %that",{eventName:d,that:a});var g=f?arguments[0]:b.makeArray(arguments),h=b.determineDemands(a,d);0===h.args.length&&e.args&&(h.args=e.args);var i=b.embodyDemands(a,h,g,{passArgs:!0}),j=b.event.invokeListener(c,i.args);return b.popActivity(),j};return b.event.impersonateListener(c,g),g},b.event.resolveSoftNamespace=function(a){if("string"!=typeof a)return null;var b=Math.max(a.lastIndexOf("."),a.lastIndexOf("}"));return a.substring(b+1)},b.event.resolveListenerRecord=function(a,c,d,e,f){var g=function(a,c){b.fail("Error in listener record - could not resolve reference ",a,' to a listener or firer. Did you miss out "events." when referring to an event firer?'+c)};b.pushActivity("resolveListenerRecord","resolving listener record for event named %eventName for component %that",{eventName:d,that:c});var h=b.makeArray(a),i=b.transform(h,function(a){var h=b.isPrimitive(a)||a.expander?{listener:a}:b.copy(a),i=b.recordToApplicable(a,c);i?h.listener=i:h.listener=h.listener||h.func||h.funcName,h.listener||g(a,' Listener record must contain a member named "listener", "func", "funcName" or "method"');var j=a.method?b.event.resolveSoftNamespace(a["this"])+"."+a.method:b.event.resolveSoftNamespace(h.listener);h.namespace||e||!j||(h.softNamespace=!0,h.namespace=(a.componentSource?a.componentSource:c.typeName)+"."+j);var k=h.listener=b.expandOptions(h.listener,c);k||g(a,"");var l=!1;return"fluid.event.firer"===k.typeName&&(k=k.fire,l=!0),h.listener=f&&(h.args||l)?b.event.dispatchListener(c,k,d,h):k,h}),j={records:i,adderWrapper:f?b.event.makeTrackedListenerAdder(c):null};return b.popActivity(),j},b.event.expandOneEvent=function(a,c){var d;return d="string"==typeof c&&"{"!==c.charAt(0)?b.getForComponent(a,["events",c]):b.expandOptions(c,a),d&&"fluid.event.firer"===d.typeName||b.fail("Error in event specification - could not resolve base event reference ",c," to an event firer: got ",d),d},b.event.expandEvents=function(a,c){return"string"==typeof c?b.event.expandOneEvent(a,c):b.transform(c,function(c){return b.event.expandOneEvent(a,c)})},b.event.resolveEvent=function(a,c,d){b.pushActivity("resolveEvent","resolving event with name %eventName attached to component %that",{eventName:c,that:a});var e=b.event.makeTrackedListenerAdder(a);"string"==typeof d&&(d={event:d});var f=d.event||d.events;f||b.fail("Event specification for event with name "+c+" does not include a base event specification: ",d);var g,h=b.event.expandEvents(a,f),i="fluid.event.firer"!==h.typeName,j=d.args||i;if(j){g=b.makeEventFirer({name:" [composite] "+b.event.nameEvent(a,c)});var k=b.event.dispatchListener(a,g.fire,c,d,i);i?b.event.listenerEngine(h,k,e):e(h).addListener(k)}else g={typeName:"fluid.event.firer"},g.fire=function(){var a=b.makeArray(arguments);b.pushActivity("fireSynthetic","firing synthetic event %eventName ",{eventName:c});var d=h.fire.apply(null,a);return b.popActivity(),d},g.addListener=function(f,g,i,j,k){var l=b.event.dispatchListener(a,f,c,d);e(h).addListener(l,g,i,j,k)},g.removeListener=function(a){h.removeListener(a)};return b.popActivity(),g},b.withEnvironment=function(c,d,e){return e=e||b.globalThreadLocal(),b.tryCatch(function(){for(var b in c)e[b]=c[b];return a.extend(e,c),d()},null,function(){for(var a in c)delete e[a]})},b.fetchContextReference=function(a,c,d,e,f){e&&(a=e(a,d));var g=a.context?d[a.context]:c;if(!g){var h=f&&f(a);return h||g}return a.noDereference?a.path:b.get(g,a.path)},b.makeEnvironmentFetcher=function(a,c,d,e){return d=d||b.globalThreadLocal,function(f){var g=d();return b.fetchContextReference(f,a,g,c,e)}},b.coerceToPrimitive=function(a){return"false"===a?!1:"true"===a?!0:isFinite(a)?Number(a):a},b.compactStringToRec=function(c,d){var e=c.indexOf("("),f=c.indexOf(")");if((-1===e^-1===f||e>f)&&b.fail("Badly-formed compact "+d+" record without matching parentheses: ",c),-1!==e&&-1!==f){var g=c.substring(0,e),h=c.substring(e+1,f),i=b.transform(h.split(","),a.trim,b.coerceToPrimitive),j={args:i};return"invoker"===d&&"!"===g.charAt(e-1)&&(g=c.substring(0,e-1),j.dynamic=!0),j["{"===g.charAt(0)?"func":"funcName"]=g,j}return"expander"===d&&b.fail("Badly-formed compact expander record without parentheses: ",c),c},b.expandPrefix="@expand:",b.expandCompactString=function(a,c){var d=a;if(0===a.indexOf(b.expandPrefix)){var e=a.substring(b.expandPrefix.length);d={expander:b.compactStringToRec(e,"expander")}}else c&&(d=b.compactStringToRec(a,c));return d};var m={listeners:"listener",modelListeners:"modelListener"},n=a.extend({invokers:"invoker"},m);b.expandCompactRec=function(a,c,d,e){var f=a.length>0?a[a.length-1]:"",g=n[f];!g&&a.length>1&&(g=m[a[a.length-2]]),b.each(d,function(d,f){return!b.isPlainObject(d)||b.isDOMish(d)||e&&"model"===f&&0===a.length?("string"==typeof d&&(d=b.expandCompactString(d,g)),void(c[f]=d)):(c[f]=b.freshContainer(d),a.push(f),b.expandCompactRec(a,c[f],d),void a.pop())})},b.expandCompact=function(a,c){var d={};return b.expandCompactRec([],d,a,c),d},b.extractEL=function(a,b){if("ALL"===b.ELstyle)return a;if(1===b.ELstyle.length){if(a.charAt(0)===b.ELstyle)return a.substring(1)}else if("${}"===b.ELstyle){var c=a.indexOf("${"),d=a.lastIndexOf("}");if(0===c&&-1!==d)return a.substring(2,d)}},b.extractELWithContext=function(a,c){var d=b.extractEL(a,c);return d&&"{"===d.charAt(0)&&d.indexOf("}")>0?b.parseContextReference(d):d?{path:d}:d},b.parseContextReference=function(a,c,d){c=c||0;var e=a.indexOf("}",c+1);-1===e&&b.fail('Cannot parse context reference "'+a+'": Malformed context reference without }');var f=a.substring(c+1,e),g=d?a.indexOf(d,e+1):a.length,h=a.substring(e+1,g);return"."===h.charAt(0)&&(h=h.substring(1)),{context:f,path:h,endpos:g}},b.renderContextReference=function(a){return"{"+a.context+"}"+(a.path?"."+a.path:"")},b.resolveContextValue=function(a,c){function d(d){b.pushActivity("resolveContextValue","resolving context value %string",{string:a});var e=c.fetcher(d);return b.pushActivity("resolvedContextValue","resolved value %string to value %value",{string:a,value:e}),b.popActivity(2),e}var e;if(c.bareContextRefs&&"{"===a.charAt(0)&&a.indexOf("}")>0)return e=b.parseContextReference(a),d(e);if(c.ELstyle&&"${}"!==c.ELstyle&&(e=b.extractELWithContext(a,c)))return d(e);for(;"string"==typeof a;){var f=a.indexOf("${"),g=a.indexOf("}",f+2);if(-1===f||-1===g)break;"{"===a.charAt(f+2)?(e=b.parseContextReference(a,f+2,"}"),g=e.endpos):e={path:a.substring(f+2,g)};var h=d(e),i=0===f&&g===a.length-1;if(void 0===h||null===h)return h;a=i?h:a.substring(0,f)+h+a.substring(g+1)}return a},b.expandExpander=function(a,c,d){var e=b.getGlobalValue(c.expander.type||"fluid.deferredInvokeCall");return e?e.call(null,a,c,d):void 0},b.fetchExpandChildren=function(c,d,e,f,g,h,i){if(f.expander){var j=b.expandExpander(c,f,i);if(i.freeRoot||b.isPrimitive(j)||b.isDOMish(j)||!b.isPlainObject(j)||b.isArrayable(j)^b.isArrayable(c))return j;a.extend(!0,c,j)}return b.each(f,function(a,b){void 0===a?c[b]=void 0:"expander"!==b&&(e[d]=b,i.strategy(c,b,d+1,e,f,g,h))}),c},b.isUnexpandable=function(a){return b.isPrimitive(a)||b.isComponent(a)||void 0!==a.nodeType||a.jquery||!b.isPlainObject(a)},b.expandSource=function(a,c,d,e,f,g,h,i,j){var k,l,m,n=b.derefMergePolicy(h);return"string"!=typeof g||n.noexpand?n.noexpand||b.isUnexpandable(g)?k=g:g.expander?k=b.expandExpander(f,g,a):(n.preserve?(k=g,m=!0):k=b.freshContainer(g),l=!0):a.defaultEL&&"{"!==g.charAt(0)?k=g:(b.pushActivity("expandContextValue","expanding context value %source held at path %path",{source:g,path:b.path.apply(null,e.slice(0,d))}),k=b.resolveContextValue(g,a),b.popActivity(1)),m||k===b.NO_VALUE||f(k),l&&j(k,g,d,e,h,i||m),m&&k!==b.NO_VALUE&&f(k),k},b.makeExpandStrategy=function(a){var c=function(c,d,e,f,g,h){return b.fetchExpandChildren(c,e||0,f||[],d,g,h,a)},e=function(e,f,g,h,i,j,k){function l(a){e[f]=a}if(g>b.strategyRecursionBailout&&b.fail("Overflow/circularity in options expansion, current path is ",h," at depth ",g,' - please ensure options are not circularly connected, or protect from expansion using the "noexpand" policy or expander'),e){if(!k&&e.hasOwnProperty(f))return e[f];void 0===i&&(i=d(a.source,h,g-1,a.sourceStrategy),j=d(a.mergePolicy,h,g-1,b.concreteTrundler));var m=a.sourceStrategy(i,f,g,h),n=b.concreteTrundler(j,f);return b.expandSource(a,e,g,h,l,m,n,k,c)}};return a.recurse=c,a.strategy=e,e},b.defaults("fluid.makeExpandOptions",{ELstyle:"${}",bareContextRefs:!0,target:b.inCreationMarker}),b.makeExpandOptions=function(c,d){return d=a.extend({},b.rawDefaults("fluid.makeExpandOptions"),d),d.defaultEL="${}"===d.ELStyle&&d.bareContextRefs,d.expandSource=function(a){return b.expandSource(d,null,0,[],b.identity,a,d.mergePolicy,!1)},b.isUnexpandable(c)?(d.strategy=b.concreteTrundler,d.initter=b.identity,"string"==typeof c?d.target=d.expandSource(c):d.target=c):(d.source=c,d.target=b.freshContainer(c),d.sourceStrategy=d.sourceStrategy||b.concreteTrundler,b.makeExpandStrategy(d),d.initter=function(){d.target=b.fetchExpandChildren(d.target,0,[],d.source,d.mergePolicy,!1,d)}),d},b.expand=function(a,c){var d=b.makeExpandOptions(a,c);return d.initter(),d.target},b.registerNamespace("fluid.expander"),b.expander.deferredCall=function(a,c,d){var e=c.expander,f=!e.args||b.isArrayable(e.args)?e.args:b.makeArray(e.args);return f=d.recurse([],f),b.invokeGlobalFunction(e.func,f)},b.deferredCall=b.expander.deferredCall,b.deferredInvokeCall=function(a,c,d){var e=c.expander,f=b.makeArray(e.args);f=d.recurse([],f);var g=e.func||e.funcName,h=d.expandSource(g)||b.recordToApplicable(e,d.contextThat);return h||b.fail("Error in expander record - "+g+" could not be resolved to a function for component ",d.contextThat),h.apply?h.apply(null,f):b.invoke(h,f,d.contextThat)},b.expander.noexpand=function(a,b){return b.expander.value?b.expander.value:b.expander.tree},b.noexpand=b.expander.noexpand}(jQuery,fluid_2_0);var fluid_2_0=fluid_2_0||{};!function(a,b){"use strict";function c(a){return a.lastIndexOf(".")}function d(a,c){return function(d){var e=c().sources,f=arguments,g=d.source||"";b.tryCatch(function(){void 0===e[g]&&(e[g]=0),++e[g],a.apply(null,f)},null,function(){--e[g]})}}b.model.makeEnvironmentStrategy=function(a){return function(b,c,d){return 0===d&&a[c]?a[c]:void 0}},b.model.defaultCreatorStrategy=function(a,b){return void 0===a[b]?(a[b]={},a[b]):void 0},b.model.defaultFetchStrategy=function(a,b){return a[b]},b.model.funcResolverStrategy=function(a,b){return a.resolvePathSegment?a.resolvePathSegment(b):void 0},b.model.traverseWithStrategy=function(a,c,d,e,f){for(var g=e.strategies,h=c.length-f,i=d;h>i;++i){if(!a)return a;for(var j,k=0;k<g.length&&(j=g[k](a,c[i],i+1,c),void 0===j);++k);j===b.NO_VALUE&&(j=void 0),a=j}return a},b.model.getValueAndSegments=function(a,c,d,e){return b.model.accessWithStrategy(a,c,b.NO_VALUE,d,e,!0)},b.model.makeTrundler=function(a){return function(c,d){return b.model.getValueAndSegments(c.root,d,a,c.segs)}},b.model.getWithStrategy=function(a,c,d,e){return b.model.accessWithStrategy(a,c,b.NO_VALUE,d,e)},b.model.setWithStrategy=function(a,c,d,e,f){b.model.accessWithStrategy(a,c,d,e,f)},b.model.accessWithStrategy=function(a,c,d,e,f,g){if(b.isPrimitive(c)||b.isArrayable(c))return b.model.accessImpl(a,c,d,e,f,g,b.model.traverseWithStrategy);var h=c.type||"default",i=e.resolvers[h];i||b.fail("Unable to find resolver of type "+h);var j=b.model.makeTrundler(e),k={root:a,segs:f};return k=i(k,c,j),c.path&&k&&(k=j(k,c.path)),g?k:k?k.root:void 0},b.registerNamespace("fluid.pathUtil");var e=function(a,b,c){var d=null;a&&(d="");for(var e=!1,f=b.length;f>c;++c){var g=b.charAt(c);if(e)e=!1,null!==d&&(d+=g);else{if("."===g)break;"\\"===g?e=!0:null!==d&&(d+=g)}}return null!==d&&(a[0]=d),c},f=[];b.pathUtil.parseEL=function(a){for(var b=[],c=0,d=a.length;d>c;){var g=e(f,a,c);b.push(f[0]),c=g+1}return b},b.pathUtil.composeSegment=function(a,b){b=b.toString();for(var c=0;c<b.length;++c){var d=b.charAt(c);("."===d||"\\"===d||"}"===d)&&(a+="\\"),a+=d}return a},b.pathUtil.escapeSegment=function(a){return b.pathUtil.composeSegment("",a)},b.pathUtil.composePath=function(a,c){return 0!==a.length&&(a+="."),b.pathUtil.composeSegment(a,c)},b.pathUtil.composeSegments=function(){for(var a="",c=0;c<arguments.length;++c)a=b.pathUtil.composePath(a,arguments[c]);return a},b.model.unescapedParser={parse:b.model.parseEL,compose:b.model.composeSegments},b.model.defaultGetConfig={parser:b.model.unescapedParser,strategies:[b.model.funcResolverStrategy,b.model.defaultFetchStrategy]},b.model.defaultSetConfig={parser:b.model.unescapedParser,strategies:[b.model.funcResolverStrategy,b.model.defaultFetchStrategy,b.model.defaultCreatorStrategy]},b.model.escapedParser={parse:b.pathUtil.parseEL,compose:b.pathUtil.composeSegments},b.model.escapedGetConfig={parser:b.model.escapedParser,strategies:[b.model.defaultFetchStrategy]},b.model.escapedSetConfig={parser:b.model.escapedParser,strategies:[b.model.defaultFetchStrategy,b.model.defaultCreatorStrategy]},b.initSimpleModel=function(a,b){return a.model=b||{},a.model},b.initRelayModel=function(a,b){return b},b.isModelComplete=function(a){return a.model!==b.inEvaluationMarker},b.enlistModelComponent=function(a){var c=b.getInstantiator(a),d=c.modelTransactions.init[a.id];return d||(d={that:a,applier:b.getForComponent(a,"applier"),complete:b.isModelComplete(a)},c.modelTransactions.init[a.id]=d),d},b.clearLinkCounts=function(a,c){b.each(a,function(b,d){"number"==typeof b?a[d]=0:c&&b.options&&"number"==typeof b.relayCount&&(b.relayCount=0)})},b.sortCompleteLast=function(a,b){return(a.completeOnInit?1:0)-(b.completeOnInit?1:0)},b.operateInitialTransaction=function(a,c){var d,e=b.allocateGuid(),f=b.getModelTransactionRec(a,e),g=b.transform(c,function(a){return d=a.that.applier.initiate("init",e),f[a.that.applier.applierId]={transaction:d},d}),h=b.values(c).sort(b.sortCompleteLast);b.each(h,function(a){var c=a.that,d=g[c.id];a.completeOnInit?b.initModelEvent(c,d,c.applier.changeListeners.listeners):b.each(a.initModels,function(a){d.fireChangeRequest({type:"ADD",segs:[],value:a}),b.clearLinkCounts(f,!0)});var e=b.shadowForComponent(c);e.modelComplete=!0}),d.commit()},b.deenlistModelComponent=function(a){var c=b.getInstantiator(a),d=c.modelTransactions.init;a.model=void 0,d[a.id].complete=!0;var e=b.find_if(d,function(a){return a.complete!==!0});e||(b.operateInitialTransaction(c,d),c.modelTransactions.init={})},b.transformToAdapter=function(a,c){var d={};return d[c]=a,function(a,c){b.model.transformWithRules(c,d,{finalApplier:a})}},b.parseModelReference=function(a,c){var d=b.parseContextReference(c);return d.segs=a.applier.parseEL(d.path),d},b.parseValidModelReference=function(a,c,d){var e,f,g=function(a){b.fail("Error in "+c+": "+d+a)};return"{"===d.charAt(0)?(e=b.parseModelReference(a,d),"model"!==e.segs[0]?g(' must be a reference into a component model beginning with "model"'):(e.modelSegs=e.segs.slice(1),delete e.path),f=b.resolveContext(e.context,a),f||g(" must be a reference to an existing component")):(f=a,e={path:d,modelSegs:a.applier.parseEL(d)}),f.applier||b.getForComponent(f,["applier"]),f.applier||g(" must be a reference to a component with a ChangeApplier (descended from fluid.modelComponent)"),e.that=f,e.applier=f.applier,e.path||(e.path=f.applier.composeSegments.apply(null,e.modelSegs)),e},b.getModelTransactionRec=function(a,c){c||b.fail("Cannot get transaction record without transaction id");var d=a.modelTransactions[c];return d||a.free||(d=a.modelTransactions[c]={},d.externalChanges={}),d},b.recordChangeListener=function(a,c,d){var e=b.shadowForComponent(a);b.recordListener(c.modelChanged,d,e)},b.registerDirectChangeRelay=function(a,c,d,e,f,g,h){var i=b.getInstantiator(a),j=h.targetApplier||a.applier,k=h.sourceApplier||d.applier,l=j.applierId;c=b.makeArray(c),e=e?b.makeArray(e):e;var m=function(a,d,k,m,n,o){var p=n.id,q=b.getModelTransactionRec(i,p);o&&n&&!q[o.applierId]&&(q[o.applierId]={transaction:n});var r=q[l];q[f]=q[f]||0;var s=!0;if(s){if(++q[f],!r){var t=j.initiate("relay",p);r=q[l]={transaction:t,relayCount:0,options:h}}g&&!h.targetApplier?g(r.transaction,h.sourceApplier?void 0:a,e,c):void 0!==a&&r.transaction.fireChangeRequest({type:"ADD",segs:c,value:a})}};e&&k.modelChanged.addListener({isRelay:!0,segs:e,transactional:h.transactional},m),d&&(b.recordChangeListener(d,k,m),a!==d&&b.recordChangeListener(a,k,m))},b.connectModelRelay=function(a,c,d,e,f){function g(a){var c=b.enlistModelComponent(a);if(c.complete){var d=b.shadowForComponent(a);d.modelComplete&&(c.completeOnInit=!0)}}var h=b.allocateGuid();g(d),g(a),f.update?f.targetApplier?b.registerDirectChangeRelay(a,c,d,e,h,null,{transactional:!1,targetApplier:f.targetApplier,update:f.update}):b.registerDirectChangeRelay(d,e,a,[],h+"-transform",f.forwardAdapter,{transactional:!0,sourceApplier:f.forwardApplier}):(b.registerDirectChangeRelay(d,e,a,c,h,f.forwardAdapter,{transactional:!1}),c&&b.registerDirectChangeRelay(a,c,d,e,h,f.backwardAdapter,{transactional:!1}))},b.model.guardedAdapter=function(a,c,d,e){var f=a.modelRelay===b.inEvaluationMarker,g=c[f?"init":"live"];g&&d.apply(null,e)},b.makeTransformPackage=function(a,c,d,e,f,g){var h={forwardHolder:{model:c},backwardHolder:{model:null}};h.generateAdapters=function(a){h.forwardAdapterImpl=b.transformToAdapter(a?a.newHolder.model:h.forwardHolder.model,e),null!==d&&(h.backwardHolder.model=b.model.transform.invertConfiguration(c),h.backwardAdapterImpl=b.transformToAdapter(h.backwardHolder.model,d))},h.forwardAdapter=function(c,d){void 0===d&&h.generateAdapters(),b.model.guardedAdapter(a,f,h.forwardAdapterImpl,arguments)},h.runTransform=function(a){a.commit(),a.reset()},h.forwardApplier=b.makeNewChangeApplier(h.forwardHolder),h.forwardApplier.isRelayApplier=!0,h.invalidator=b.makeEventFirer({name:"Invalidator for model relay with applier "+h.forwardApplier.applierId}),null!==d&&(h.backwardApplier=b.makeNewChangeApplier(h.backwardHolder),h.backwardAdapter=function(){b.model.guardedAdapter(a,g,h.backwardAdapterImpl,arguments)}),h.update=h.invalidator.fire;var i={targetApplier:h.forwardApplier,update:h.update,refCount:0};return h.forwardHolder.model=b.parseImplicitRelay(a,c,[],i),h.refCount=i.refCount,h.generateAdapters(),h.invalidator.addListener(h.generateAdapters),h.invalidator.addListener(h.runTransform),h},b.singleTransformToFull=function(b){var c=a.extend(!0,{valuePath:""},b);return{"":{transform:c}}},b.model.relayConditions={initOnly:{init:!0,live:!1},liveOnly:{init:!1,live:!0},never:{init:!1,live:!1},always:{init:!0,live:!0}},b.model.parseRelayCondition=function(a){return b.model.relayConditions[a||"always"]},b.parseModelRelay=function(a,c){var d=c.source?b.parseValidModelReference(a,'modelRelay record member "source"',c.source):{path:null,modelSegs:null},e=b.parseValidModelReference(a,'modelRelay record member "target"',c.target),f=c.singleTransform?b.singleTransformToFull(c.singleTransform):c.transform;f||b.fail('Cannot parse modelRelay record without element "singleTransform" or "transform":',c);var g=b.model.parseRelayCondition(c.forward),h=b.model.parseRelayCondition(c.backward),i=b.makeTransformPackage(a,f,d.path,e.path,g,h);0===i.refCount?b.connectModelRelay(d.that||a,d.modelSegs,e.that,e.modelSegs,{forwardAdapter:i.forwardAdapter,backwardAdapter:i.backwardAdapter}):b.connectModelRelay(d.that||a,d.modelSegs,e.that,e.modelSegs,i)},b.parseImplicitRelay=function(a,c,d,e){var f;if("string"==typeof c&&"{"===c.charAt(0)){var g=b.parseModelReference(a,c),h=b.resolveContext(g.context,a);if("model"===g.segs[0]){var i=g.segs.slice(1);++e.refCount,b.connectModelRelay(a,d,h,i,e)}else f=b.getForComponent(h,g.segs)}else b.isPrimitive(c)||!b.isPlainObject(c)?f=c:c.expander&&b.isPlainObject(c.expander)?f=b.expandOptions(c,a):(f=b.freshContainer(c),b.each(c,function(c,g){d.push(g);var h=b.parseImplicitRelay(a,c,d,e);void 0!==h&&(f[g]=h),d.pop()}));return f},b.model.notifyExternal=function(a){var c=a?b.values(a.externalChanges):[];c.sort(b.priorityComparator);for(var d=0;d<c.length;++d){var e=c[d],f=e.args[5];f.destroyed||e.listener.apply(null,e.args)}b.clearLinkCounts(a,!0)},b.model.commitRelays=function(a,c){var d=a.modelTransactions[c];b.each(d,function(a){a.transaction&&(a.transaction.commit("relay"),a.transaction.reset())})},b.model.updateRelays=function(a,c){var d=a.modelTransactions[c],e=0;return b.each(d,function(a){a.options&&a.transaction&&a.transaction.changeRecord.changes>0&&a.relayCount<2&&a.options.update&&(a.relayCount++,b.clearLinkCounts(d),a.options.update(a.transaction,d),++e)}),e},b.establishModelRelay=function(a,c,d,e,f){function g(a){for(;b.model.updateRelays(l,a.id)>0;);}function h(a,c,d){"relay"!==d&&b.model.commitRelays(l,a.id)}function i(a,c,d){"relay"!==d&&(b.model.notifyExternal(l.modelTransactions[a.id]),delete l.modelTransactions[a.id])}b.mergeModelListeners(a,d);var j=b.enlistModelComponent(a);b.each(e,function(c){b.parseModelRelay(a,c)});var k=b.transform(c,function(c){return b.parseImplicitRelay(a,c,[],{refCount:0})});j.initModels=k;var l=b.getInstantiator(a);return f.preCommit.addListener(g),f.preCommit.addListener(h),f.postCommit.addListener(i),b.deenlistModelComponent(a),f.holder.model},b.defaults("fluid.commonModelComponent",{gradeNames:["fluid.littleComponent","autoInit"],mergePolicy:{modelListeners:b.makeMergeListenersPolicy(b.arrayConcatPolicy)}}),b.defaults("fluid.modelComponent",{gradeNames:["fluid.commonModelComponent","autoInit"],members:{model:"@expand:fluid.initSimpleModel({that}, {that}.options.model)",applier:"@expand:fluid.makeChangeApplier({that}.model, {that}.options.changeApplierOptions)",modelListeners:"@expand:fluid.mergeModelListeners({that}, {that}.options.modelListeners)"},mergePolicy:{model:"preserve"}}),b.defaults("fluid.modelRelayComponent",{gradeNames:["fluid.commonModelComponent","fluid.eventedComponent","autoInit"],changeApplierOptions:{relayStyle:!0,cullUnchanged:!0},members:{model:"@expand:fluid.initRelayModel({that}, {that}.modelRelay)",applier:"@expand:fluid.makeNewChangeApplier({that}, {that}.options.changeApplierOptions)",modelRelay:"@expand:fluid.establishModelRelay({that}, {that}.options.model, {that}.options.modelListeners, {that}.options.modelRelay, {that}.applier)"},mergePolicy:{model:{noexpand:!0,func:b.arrayConcatPolicy},modelRelay:{noexpand:!0,func:b.arrayConcatPolicy}}}),b.defaults("fluid.standardComponent",{gradeNames:["fluid.modelComponent","fluid.eventedComponent","autoInit"]}),b.defaults("fluid.standardRelayComponent",{gradeNames:["fluid.modelRelayComponent","autoInit"]}),b.modelChangedToChange=function(a,c){var d=c[0],e=c[1],f=c[3];return a?{value:c[0],oldValue:c[1],path:c[2]}:{value:b.get(d,f),oldValue:b.get(e,f),path:f}},b.resolveModelListener=function(a,c,d){var e=function(){if(!b.isDestroyed(a)){var e=b.modelChangedToChange(d,arguments),f=[e],g={change:e,arguments:f};c.args&&(f=b.expandOptions(c.args,a,{},g)),b.event.invokeListener(c.listener,b.makeArray(f))}};return b.event.impersonateListener(c.listener,e),e},b.mergeModelListeners=function(a,c){var d=0;b.each(c,function(c,e){"string"==typeof c&&(c={funcName:c});var f=b.event.resolveListenerRecord(c,a,"modelListeners",null,!1),g=b.parseValidModelReference(a,"modelListeners entry",e),h=g.applier.preCommit;b.each(f.records,function(c){function e(){if(h&&b.isModelComplete(g.that)){var c=g.applier.initiate("init");b.initModelEvent(a,c,[i]),c.commit()}}var f=b.resolveModelListener(a,c,h),i={listener:f,listenerIndex:d,segs:g.modelSegs,path:g.path,includeSource:c.includeSource,excludeSource:c.excludeSource,priority:c.priority,guardSource:c.guardSource,transactional:!0};++d,c.guardSource?b.addSourceGuardedListener(g.applier,i,c.guardSource,f,"modelChanged",c.namespace,c.softNamespace):g.applier.modelChanged.addListener(i,f,c.namespace,c.softNamespace),b.recordChangeListener(a,g.applier,f),a===g.that||b.isModelComplete(a)||a.events.onCreate.addListener(e)})})},b.addSourceGuardedListener=function(a,c,d,e,f,g,h){f=f||"modelChanged";var i=function(b,c,f,g){return a.hasChangeSource(d,g)?void 0:e.apply(null,arguments)};b.event.impersonateListener(e,i),a[f].addListener(c,i,g,h)},b.fireSourcedChange=function(a,b,c,d){a.fireChangeRequest({path:b,value:c,source:d})},b.requestChanges=function(a,b){for(var c=0;c<b.length;++c)a.fireChangeRequest(b[c])},b.bindRequestChange=function(a){a.requestChange=a.change=function(b,c,d){var e={path:b,value:c,type:d};a.fireChangeRequest(e)}},b.identifyChangeListener=function(a){return b.event.identifyListener(a)||a},b.typeCode=function(a){return b.isPrimitive(a)||!b.isPlainObject(a)?"primitive":b.isArrayable(a)?"array":"object"},b.model.isChangedPath=function(a,b){for(var c=0;c<=b.length;++c){if("string"==typeof a)return!0;c<b.length&&a&&(a=a[b[c]])}return!1},b.model.setChangedPath=function(a,c,d){var e=function(e){c.unshift(e),b.model.setSimple(a,c,d),c.shift()};b.model.isChangedPath(a.changeMap,c)||(++a.changes,e("changeMap")),b.model.isChangedPath(a.deltaMap,c)||(++a.deltas,e("deltaMap"))},b.model.fetchChangeChildren=function(a,c,d,e,f){b.each(e,function(e,g){d[c]=g,b.model.applyChangeStrategy(a,g,c,d,e,f),d.length=c})},b.model.isSameValue=function(a,b){if("number"!=typeof a||"number"!=typeof b)return a===b;if(a===b)return!0;var c=Math.abs((a-b)/b);return 1e-12>c},b.model.applyChangeStrategy=function(a,c,d,e,f,g){var h=a[c],i=b.typeCode(f),j=b.typeCode(h),k=b.NO_VALUE;"primitive"===i?b.model.isSameValue(h,f)||(k=f,++g.unchanged):(j!==i||"array"===i&&f.length!==h.length)&&(k=b.freshContainer(f)),k!==b.NO_VALUE&&(a[c]=k,g.changeMap&&b.model.setChangedPath(g,e,g.inverse?"DELETE":"ADD")),"primitive"!==i&&b.model.fetchChangeChildren(a[c],d+1,e,f,g)},b.model.stepTargetAccess=function(a,c,d,e,f,g){for(var h=e;f>h;++h){var i=a[d[h]];a=b.model.traverseWithStrategy(a,d,h,g["ADD"===c?"resolverSetConfig":"resolverGetConfig"],d.length-h-1),i!==a&&g.changeMap&&b.model.setChangedPath(g,d.slice(0,h+1),"ADD")}return{root:a,last:d[f]}},b.model.defaultAccessorConfig=function(a){return a=a||{},a.resolverSetConfig=a.resolverSetConfig||b.model.defaultSetConfig,a.resolverGetConfig=a.resolverGetConfig||b.model.defaultGetConfig,a},b.model.applyHolderChangeRequest=function(a,c,d){d=b.model.defaultAccessorConfig(d),d.deltaMap=d.changeMap?{}:null,d.deltas=0;var e,f=c.segs.length,g=0===f;if(g?e={root:a,last:"model"}:(a.model||(a.model={},b.model.setChangedPath(d,[],d.inverse?"DELETE":"ADD")),e=b.model.stepTargetAccess(a.model,c.type,c.segs,0,f-1,d)),"ADD"===c.type){var h=c.value,i=b.makeArray(c.segs);b.model.applyChangeStrategy(e.root,e.last,f-1,i,h,d,g)}else"DELETE"===c.type?e.root&&void 0!==e.root[e.last]&&(delete e.root[e.last],d.changeMap&&b.model.setChangedPath(d,c.segs,"DELETE")):b.fail("Unrecognised change type of "+c.type);return d.deltas?d.deltaMap:null},b.model.diff=function(a,c,d){d=d||{changes:0,unchanged:0,changeMap:{}};var e,f=b.typeCode(a),g=b.typeCode(c);if("primitive"===f&&"primitive"===g)e=b.model.isSameValue(a,c);else if("primitive"===f^"primitive"===g)e=!1;else{var h={model:b.copy(a)};b.model.applyHolderChangeRequest(h,{value:c,segs:[],type:"ADD"},d);var i={model:b.copy(c)};d.inverse=!0,b.model.applyHolderChangeRequest(i,{value:a,segs:[],type:"ADD"},d),e=0===d.changes}return e===!1&&0===d.changes?(d.changes=1,d.changeMap=void 0===c?"DELETE":"ADD"):e===!0&&0===d.unchanged&&(d.unchanged=1),e},b.matchChanges=function(a,c,d){for(var e=d.model,f=a,g=["model"],h=!1,i=[],j=0;j<c.length;++j){var k=c[j];"*"===k?j===c.length-1?h=!0:b.fail("Wildcard specification in modelChanged listener is only supported for the final path segment: "+c.join(".")):(g.push(k),f=b.isPrimitive(f)?f:f[k],e=e?e[k]:void 0)}return f&&(h?b.each(e,function(a,b){i.push(g.concat(b))}):i.push(g)),i},b.storeExternalChange=function(a,c,d,e,f){var g=c.composeSegments.apply(null,d),h=[c.applierId,b.event.identifyListener(e.listener),e.listenerIndex,g],i=h.join("|");a.externalChanges[i]={listener:e.listener,priority:e.priority,args:f}},b.isExcludedChangeSource=function(a,b){if(!b.excludeSource)return!1;var c=b.excludeSource["*"];for(var d in a.sources)b.excludeSource[d]&&(c=!0),b.includeSource[d]&&(c=!1);return c},b.notifyModelChanges=function(a,c,d,e,f,g,h,i){for(var j=b.getInstantiator(i),k=g&&b.getModelTransactionRec(j,g.id),l=0;l<a.length;++l)for(var m=a[l],n=b.matchChanges(c,m.segs,d),o=0;o<n.length;++o){if(h.destroyed)return;var p=n[o];m.listener=b.event.resolveListener(m.listener);var q=[b.model.getSimple(d,p),b.model.getSimple(e,p),p.slice(1),f,g,h];if(!m.isRelay){var r=b.model.diff(q[0],q[1]);if(r)continue;var s=b.isExcludedChangeSource(g,m);if(s)continue}k&&!m.isRelay&&m.transactional?b.storeExternalChange(k,h,p,m,q):m.listener.apply(null,q)}},b.bindELMethods=function(a){a.parseEL=function(c){return b.model.pathToSegments(c,a.options.resolverSetConfig)},a.composeSegments=function(){return a.options.resolverSetConfig.parser.compose.apply(null,arguments)}},b.initModelEvent=function(a,c,d){b.notifyModelChanges(d,"ADD",c.oldHolder,b.emptyHolder,null,c,a)},b.emptyHolder={model:void 0},b.makeNewChangeApplier=function(a,c){function d(a){a.type||(a.type="ADD"),a.segs=a.segs||f.parseEL(a.path)}c=b.model.defaultAccessorConfig(c);var e=b.allocateGuid(),f={applierId:e,holder:a,changeListeners:{listeners:[],transListeners:[]},options:c,modelChanged:{},preCommit:b.makeEventFirer({name:"preCommit event for ChangeApplier "}),postCommit:b.makeEventFirer({name:"postCommit event for ChangeApplier "})};return f.destroy=function(){f.preCommit.destroy(),f.postCommit.destroy(),f.destroyed=!0},f.modelChanged.addListener=function(a,c,d,e){a="string"==typeof a?{path:a}:b.copy(a),a.id=b.event.identifyListener(c),a.namespace=d,a.softNamespace=e,"string"==typeof c&&(c={globalName:c}),a.listener=c,a.transactional!==!1&&(a.transactional=!0),a.segs=a.segs||f.parseEL(a.path);var g=f.changeListeners[a.transactional?"transListeners":"listeners"];a.excludeSource=b.arrayToHash(b.makeArray(a.excludeSource||(a.includeSource?"*":void 0))),a.includeSource=b.arrayToHash(b.makeArray(a.includeSource)),a.priority=b.event.mapPriority(a.priority,g.length),g.push(a)},f.modelChanged.removeListener=function(a){var c=b.event.identifyListener(a),d="string"==typeof a?a:null,e=function(a){return a.id===c||a.namespace===d};b.remove_if(f.changeListeners.listeners,e),b.remove_if(f.changeListeners.transListeners,e)},f.modelChanged.isRelayEvent=!0,f.fireChangeRequest=function(a){var b=f.initiate();b.fireChangeRequest(a),b.commit()},f.initiate=function(e,g){e=e||"local";var h="relay"===e,i={instanceId:b.allocateGuid(),id:g||b.allocateGuid(),sources:{},changeRecord:{resolverSetConfig:c.resolverSetConfig,resolverGetConfig:c.resolverGetConfig},reset:function(){i.oldHolder=a,i.newHolder={model:b.copy(a.model)},i.changeRecord.changes=0,i.changeRecord.unchanged=0,i.changeRecord.changeMap={}},commit:function(c){if(f.preCommit.fire(i,f,c),i.changeRecord.changes>0){var d={model:a.model};a.model=i.newHolder.model,b.notifyModelChanges(f.changeListeners.transListeners,i.changeRecord.changeMap,a,d,null,i,f,a)}h||f.postCommit.fire(i,f,c)},fireChangeRequest:function(c){d(c),c.transactionId=i.id;var e=b.model.applyHolderChangeRequest(i.newHolder,c,i.changeRecord);b.notifyModelChanges(f.changeListeners.listeners,e,i.newHolder,a,c,i,f,a)}};return i.sources[e]=!0,i.reset(),b.bindRequestChange(i),i},f.hasChangeSource=function(a,b){return b?b[a]:!1},b.bindRequestChange(f),b.bindELMethods(f),f},b.pathUtil.getPathSegment=function(a,b){
return e(f,a,b),f[0]},b.pathUtil.getHeadPath=function(a){return b.pathUtil.getPathSegment(a,0)},b.pathUtil.getFromHeadPath=function(a){var b=e(null,a,0);return b===a.length?"":a.substring(b+1)},b.pathUtil.getToTailPath=function(a){var b=c(a);return-1===b?"":a.substring(0,b)},b.pathUtil.getTailPath=function(a){var d=c(a);return b.pathUtil.getPathSegment(a,d+1)},b.pathUtil.matchSegments=function(a,b,c,d){if(d-c!==a.length)return!1;for(var e=c;d>e;++e)if(b[e]!==a[e-c])return!1;return!0},b.pathUtil.getExcessPath=function(a,c){var d=c.indexOf(a);return 0!==d&&b.fail("Path "+a+" is not a prefix of path "+c),a.length===c.length?"":("."!==c[a.length]&&b.fail("Path "+a+" is not properly nested in path "+c),c.substring(a.length+1))},b.pathUtil.matchPath=function(a,c,d){for(var e=[];;){if(""===c^""===a&&d)return null;if(!a||!c)break;var f=b.pathUtil.getHeadPath(a),g=b.pathUtil.getHeadPath(c);if("*"!==f&&f!==g)return null;e.push(g),a=b.pathUtil.getFromHeadPath(a),c=b.pathUtil.getFromHeadPath(c)}return e},b.model.isNullChange=function(a,c,d){if("ADD"===c.type&&!c.forceChange){var e=b.get(a,c.segs,d);if(e===c.value)return!0}},b.model.applyChangeRequest=function(c,d,e){var f=b.model.accessWithStrategy(c,d.path,b.VALUE,e||b.model.defaultSetConfig,null,!0),g=f.segs[f.segs.length-1];"ADD"===d.type||"MERGE"===d.type?0===f.segs.length||"MERGE"===d.type&&f.root[g]?("ADD"===d.type&&b.clear(f.root),a.extend(!0,0===f.segs.length?f.root:f.root[g],d.value)):f.root[g]=d.value:"DELETE"===d.type&&(0===f.segs.length?b.clear(f.root):delete f.root[g])},b.makeChangeApplier=function(a,c){return b.makeHolderChangeApplier({model:a},c)},b.makeHolderChangeApplier=function(a,c){function e(a){if(!a)return null;var c=function(a){return function(d,e,f){var g=a(d,e,f);return g===!1?!1:b.model.isNullChange(d,e)?(c.culled=!0,!1):void 0}};return c}function f(a,c){var d=c,e=!1,f=Number.MAX_VALUE;"string"==typeof c&&(c={path:c}),d=c.path,e=c.transactional,void 0!==c.priority&&(f=c.priority),"!"===d.charAt(0)&&(e=!0,d=d.substring(1));var g=function(c,g,h){var i=b.event.identifyListener(a),j=g.guids[i];if(j&&h)h&&(j.accumulate||(j.accumulate=[]),j.accumulate.push(h));else{var k=b.pathUtil.matchPath(d,c);if(null!==k){var l={match:k,pathSpec:d,listener:a,priority:f,transactional:e};h&&(l.accumulate=[h]),g.guids[i]=l;var m=e?"transListeners":"listeners";g[m].push(l),g.all.push(l)}}};return b.event.impersonateListener(a,g),g}function g(a,b,c,d,e){return p[a].fireToListeners(b[d],c,e)}function h(a,b){return a.priority-b.priority}function i(a,b,c,d){p[a].fire(b,c,d),c.all.sort(h),c.listeners.sort(h),c.transListeners.sort(h)}function j(){return{guids:{},all:[],listeners:[],transListeners:[]}}function k(a,b){var c=j();return i(a,b,c),c}function l(a,b,c,d){var e=k(a,b);return g(a,e,c,"all",d)}function m(a,b){a[b]={addListener:function(a,c,d,e){p[b].addListener(f(c,a),d,null,null,e)},removeListener:function(a){p[b].removeListener(a)}}}function n(a){a.type||(a.type="ADD"),a.segs=r.parseEL(a.path)}function o(a,b,c,d,e,f){for(var g=j(),h=0;h<c.length;++h)i(a,c[h].path,g,c[h]);for(var k=0;k<g[b].length;++k){var l=g[b][k];void 0!==e&&(d[e]=l.accumulate),void 0!==f&&(d[f]=l.match);var m=l.listener.apply(null,d);if(m===!1)return!1}}c=b.model.defaultAccessorConfig(c);var p={guards:b.makeEventFirer({preventable:!0,name:"guard event"}),postGuards:b.makeEventFirer({preventable:!0,name:"postGuard event"}),modelChanged:b.makeEventFirer({name:"modelChanged event"})},q=b.threadLocal(function(){return{sources:{}}}),r={applierId:b.allocateGuid(),holder:a,options:c,destroy:b.identity};m(r,"guards"),m(r,"postGuards"),m(r,"modelChanged");var s={fireChangeRequest:function(a){r.fireChangeRequest(a,!0)}};return b.bindRequestChange(s),r.fireChangeRequest=function(a){n(a);var b=r.initiate();b.fireChangeRequest(a),b.commit()},r.fireChangeRequest=d(r.fireChangeRequest,q),b.bindRequestChange(r),b.bindELMethods(r),r.initiate=function(f){var g=!1,h=[];c.thin?f=a.model:(f=f||{},b.model.copyModel(f,a.model));var i={commit:function(){var d;if(g)return!1;var e=o("postGuards","transListeners",h,[f,null,i],1);return e===!1||g?!1:(c.thin?d=a.model:(d={},b.model.copyModel(d,a.model),b.clear(a.model),b.model.copyModel(a.model,f)),void o("modelChanged","all",h,[a.model,d,null,null],2,3))},fireChangeRequest:function(d){if(n(d),!c.cullUnchanged||!b.model.isNullChange(a.model,d,c.resolverGetConfig)){var j=e(c.cullUnchanged),k=l("guards",d.path,[f,d,i],j);k!==!1||j&&j.culled||(g=!0),g||j&&j.culled||(b.model.applyChangeRequest(f,d,c.resolverSetConfig),h.push(d))}}};return i.fireChangeRequest=d(i.fireChangeRequest,q),b.bindRequestChange(i),i},r.hasChangeSource=function(a){return q().sources[a]>0},r},b.makeSuperApplier=function(){var a=[],c={};return c.addSubApplier=function(b,c){a.push({path:b,subApplier:c})},c.fireChangeRequest=function(c){for(var d=0;d<a.length;++d){var e=a[d].path;if(0===c.path.indexOf(e)){var f=c.path.substring(e.length+1),g=b.copy(c);g.path=f,a[d].subApplier.fireChangeRequest(g)}}},b.bindRequestChange(c),c},b.attachModel=function(a,c,d){for(var e=b.model.parseEL(c),f=0;f<e.length-1;++f){var g=e[f],h=a[g];h||(a[g]=h={}),a=h}a[e[e.length-1]]=d},b.assembleModel=function(a){var c={},d=b.makeSuperApplier(),e={model:c,applier:d};for(var f in a){var g=a[f];b.attachModel(c,f,g.model),g.applier&&d.addSubApplier(f,g.applier)}return e}}(jQuery,fluid_2_0),function(){"use strict";fluid.defaults("berg.clock",{gradeNames:["fluid.eventedComponent","autoInit"],freq:1,members:{time:0,freq:"{that}.options.freq",tickDuration:{expander:{funcName:"berg.clock.calcTickDuration",args:"{that}.options.freq"}}},invokers:{start:"fluid.identity()",tick:"fluid.identity()",stop:"fluid.identity()"},events:{onTick:null}}),berg.clock.calcTickDuration=function(a){return 1/a},fluid.defaults("berg.clock.offline",{gradeNames:["berg.clock","autoInit"],invokers:{tick:{funcName:"berg.clock.offline.tick",args:["{that}"]}}}),berg.clock.offline.round=function(a){return Math.round(1e14*a)/1e14},berg.clock.offline.tick=function(a){var b=a.time+a.tickDuration;a.time=berg.clock.offline.round(b),a.events.onTick.fire(a.time,a.freq)},fluid.defaults("berg.clock.realtime",{gradeNames:["berg.clock","autoInit"],members:{time:"@expand:berg.clock.realtime.now()"},invokers:{tick:{funcName:"berg.clock.realtime.tick",args:["{that}"]}}}),berg.clock.realtime.now=function(){return performance.now()},"undefined"==typeof performance&&(berg.clock.realtime.now=function(){return Date.now()/1e3}),berg.clock.realtime.tick=function(a){a.time=berg.clock.realtime.now(),a.events.onTick.fire(a.time,a.freq)}}(),function(){"use strict";fluid.registerNamespace("berg"),berg.priorityQueue=function(){var a={items:[]};return a.push=function(b){if(b){if(void 0===b.priority)throw new Error("An item without a priority cannot be added to the queue.");a.items.push(b),a.bubbleUp(a.items.length-1)}},a.peek=function(){return a.items[0]},a.pop=function(){var b=a.items[0],c=a.items.pop();return a.items.length>0&&(a.items[0]=c,a.sinkDown(0)),b},a.remove=function(b){for(var c=a.items.length,d=0;c>d;d++)if(a.items[d]===b){var e=a.items.pop();if(d===c-1)break;a.items[d]=e,a.bubbleUp(d),a.sinkDown(d);break}},a.size=function(){return a.items.length},a.clear=function(){a.items.length=0},a.bubbleUp=function(b){for(var c=a.items[b];b>0;){var d=b-1>>1,e=a.items[d];if(e.priority<=c.priority)break;a.items[d]=c,a.items[b]=e,b=d}},a.sinkDown=function(b){for(var c,d=a.items.length,e=a.items[b];;){var f=2*(b+1),g=f-1,h=null;if(d>g&&(c=a.items[g],c.priority<e.priority&&(h=g)),d>f){var i=a.items[f],j=null===h?e:c;i.priority<j.priority&&(h=f)}if(null===h)break;a.items[b]=a.items[h],a.items[h]=e,b=h}},a}}(),function(){"use strict";berg.getGlobalSelf=function(){return self},fluid.defaults("berg.postMessageSender",{gradeNames:["fluid.eventedComponent","autoInit"],members:{messageTarget:"@expand:berg.getGlobalSelf()"},invokers:{postMessage:"berg.postMessageSender.postMessage({arguments}.0, {arguments}.1, {that}.messageTarget)"}}),berg.postMessageSender.postMessage=function(a,b,c){if("string"!=typeof a)throw new Error("Can't post a message without a message type.");var d={type:a,args:b};c.postMessage(d)},fluid.defaults("berg.postMessageListener",{gradeNames:["fluid.eventedComponent","autoInit"],members:{messageSource:"@expand:berg.getGlobalSelf()"},events:{onError:null},listeners:{onCreate:["berg.postMessageListener.bind({that})"],onError:[{namespace:"failOnError",funcName:"fluid.fail"}]}}),berg.postMessageListener.bind=function(a){a.messageSource.addEventListener("message",function(b){var c=b.data;c.type||a.events.onError.fire("Received a remote message without a type. "+fluid.prettyPrintJSON(c));var d=a[c.type];a.options.invokers[c.type]&&d||a.events.onError.fire("Received a message of type "+c.type+", which did not resolve to a component invoker. Invokers: "+fluid.prettyPrintJSON(a.options.invokers));var e=fluid.makeArray(c.args);d.apply(null,e)},!1)}}(),function(){"use strict";fluid.defaults("berg.scheduler",{gradeNames:["fluid.standardRelayComponent","autoInit"],members:{queue:"@expand:berg.priorityQueue()"},model:{timeScale:1},components:{clock:{type:"berg.clock.offline"}},invokers:{start:"{clock}.start()",stop:"{clock}.stop()",tick:"berg.scheduler.tick({arguments}.0, {that})",schedule:"berg.scheduler.schedule({arguments}.0, {that})",once:"berg.scheduler.once({arguments}.0, {arguments}.1, {that})",repeat:{funcName:"berg.scheduler.repeat",args:["{arguments}.0","{arguments}.1","{arguments}.2","{arguments}.3","{that}"]},clear:"{that}.queue.remove({arguments}.0)",clearAll:"{that}.queue.clear()",setTimeScale:{changePath:"timeScale",value:"{arguments}.0"},scheduleEvent:{funcName:"berg.scheduler.scheduleEvent",args:["{arguments}.0","{that}"]},invokeCallback:{funcName:"berg.scheduler.invokeCallback",args:["{arguments}.0","{arguments}.1"]}},modelListeners:{timeScale:{funcName:"berg.scheduler.scaleEventTimes",args:["{that}.queue","{change}.value"],excludeSource:"init"}},listeners:{"{clock}.events.onTick":{func:"{scheduler}.tick"},onCreate:["{that}.start()"]}}),berg.scheduler.calcPriority=function(a,b,c){return a+b*c},berg.scheduler.scaleEventTimes=function(a,b){for(var c=0;c<a.items.length;c++){var d=a.items[c];d.priority=berg.scheduler.calcPriority(d.scheduledAt,d.time,b)}},berg.scheduler.expandRepeatingEventSpec=function(a,b){"number"!=typeof b.time&&(b.time=0),b.interval=1/b.freq,b.end="number"!=typeof b.end?1/0:b.end+a},berg.scheduler.validateEventSpec=function(a){if("repeat"===a.type&&"number"!=typeof a.freq)throw new Error("No freq was specified for scheduled event: "+fluid.prettyPrintJSON(a));if("number"!=typeof a.time)throw new Error("No time was specified for scheduled event: "+fluid.prettyPrintJSON(a))},berg.scheduler.invokeCallback=function(a,b){b.callback(a,b)},berg.scheduler.evaluateScoreEvent=function(a,b,c){c.invokeCallback(a,b),"repeat"===b.type&&b.end>a&&(b.priority=berg.scheduler.calcPriority(a,b.interval,c.model.timeScale),c.queue.push(b))},berg.scheduler.scheduleEvent=function(a,b){var c=b.clock.time,d=b.model.timeScale;return a.type||(a.type="once"),"repeat"===a.type&&berg.scheduler.expandRepeatingEventSpec(c,a),"number"!=typeof a.scheduledAt&&(a.scheduledAt=c),berg.scheduler.validateEventSpec(a),a.priority=berg.scheduler.calcPriority(c,a.time,d),a.priority<=c?berg.scheduler.evaluateScoreEvent(c,a,b):b.queue.push(a),a},berg.scheduler.scheduleEvents=function(a,b){return a.forEach(function(a){b.scheduleEvent(a)}),a},berg.scheduler.schedule=function(a,b){return fluid.isArrayable(a)?berg.scheduler.scheduleEvents(a,b):b.scheduleEvent(a)},berg.scheduler.once=function(a,b,c){var d={type:"once",time:a,callback:b};return c.scheduleEvent(d)},berg.scheduler.repeat=function(a,b,c,d,e){var f={type:"repeat",freq:a,time:c,end:d,callback:b};return e.scheduleEvent(f)},berg.scheduler.tick=function(a,b){for(var c=b.queue.peek();c&&c.priority<=a;)b.queue.pop(),berg.scheduler.evaluateScoreEvent(a,c,b),c=b.queue.peek()}}(),function(){"use strict";fluid.defaults("berg.scheduler.postMessage",{gradeNames:["berg.postMessageListener","berg.postMessageSender","berg.scheduler","autoInit"],invokers:{invokeCallback:{funcName:"berg.scheduler.postMessage.post",args:["invokeCallback",["{arguments}.0","{arguments}.1"],"{that}"]}}}),berg.scheduler.postMessage.post=function(a,b,c){c.postMessage(a,b)},fluid.defaults("berg.scheduler.workerProxy",{gradeNames:["berg.scheduler","berg.postMessageListener","berg.postMessageSender","autoInit"],scriptPath:"../../dist/bergson-all-worker.js",remoteSchedulerOptions:{components:{clock:{type:"berg.clock.setInterval",options:{freq:.01}}}},members:{callbackMap:{},worker:"@expand:berg.scheduler.workerProxy.createWorker({that}.options.scriptPath)",messageTarget:"{that}.worker",messageSource:"{that}.worker"},components:{clock:{type:"berg.clock"}},invokers:{start:"{that}.postMessage(start)",stop:"{that}.postMessage(stop)",tick:"fluid.identity()",invokeCallback:"berg.scheduler.workerProxy.invokeCallback({arguments}.0, {arguments}.1, {that})",scheduleEvent:"berg.scheduler.workerProxy.scheduleEvent({arguments}.0, {that})",clear:"{that}.postMessage(clear, {arguments}.0)",clearAll:"{that}.postMessage(clearAll)",setTimeScale:"{that}.postMessage(setTimeScale, {arguments}.0)"},listeners:{onCreate:[{func:"{that}.postMessage",args:["create",["berg.scheduler.postMessage","{that}.options.remoteSchedulerOptions"]]}],onDestroy:[{"this":"{that}.worker",method:"terminate"}]}}),berg.scheduler.workerProxy.createWorker=function(a){return new Worker(a)},berg.scheduler.workerProxy.invokeCallback=function(a,b,c){var d=c.callbackMap[b.id];"function"==typeof d?d(a,b):c.events.onError.fire("A callback function was not found for score event: "+fluid.prettyPrintJSON(b))},berg.scheduler.workerProxy.scheduleEvent=function(a,b){a.id||(a.id=fluid.allocateGuid()),b.callbackMap[a.id]=a.callback,delete a.callback,b.postMessage("scheduleEvent",a)}}(),function(){"use strict";fluid.defaults("berg.clock.raf",{gradeNames:["berg.clock.realtime","autoInit"],freq:60,members:{requestID:null},invokers:{start:{funcName:"berg.clock.raf.requestNextTick",args:["{that}"]},tick:{funcName:"berg.clock.raf.tick",args:["{that}"]},stop:{funcName:"berg.clock.raf.stop",args:["{that}"]}}}),berg.clock.raf.requestNextTick=function(a){a.requestID=requestAnimationFrame(a.tick)},berg.clock.raf.tick=function(a){berg.clock.raf.requestNextTick(a);var b=performance.now();a.time=b,a.events.onTick.fire(b,a.freq)},berg.clock.raf.stop=function(a){cancelAnimationFrame(a.requestID)}}(),function(){"use strict";fluid.defaults("berg.clock.setInterval",{gradeNames:["berg.clock.realtime","autoInit"],freq:10,members:{intervalID:null},invokers:{start:{funcName:"berg.clock.setInterval.start",args:["{that}"]},stop:{funcName:"berg.clock.setInterval.stop",args:["{that}"]}}}),berg.clock.setInterval.start=function(a){a.intervalID=setInterval(a.tick,1e3/a.freq)},berg.clock.setInterval.stop=function(a){clearInterval(a.intervalID)}}(),function(){"use strict";berg.worker=function(a){var b,c,d=typeof a;if("function"===d)a="("+a.toString()+")();";else if("string"!==d)throw new Error("A berg.worker must be initialized with a String or a Function.");return window.Blob?(c=new Blob([a],{type:"text/javascript"}),b=(window.URL||window.webkitURL).createObjectURL(c)):b="data:text/javascript;base64,"+window.btoa(a),new Worker(b)},fluid.defaults("berg.clock.workerSetInterval",{gradeNames:["berg.clock.realtime","berg.postMessageListener","berg.postMessageSender","autoInit"],freq:10,members:{worker:"@expand:berg.clock.workerSetInterval.createWorker()",messageTarget:"{that}.worker",messageSource:"{that}.worker"},invokers:{start:"{that}.events.onStart.fire",stop:"{that}.events.onStop.fire"},events:{onStart:null,onStop:null},listeners:{onStart:[{func:"{that}.postMessage",args:["start",{freq:"{that}.freq"}]}],onStop:["{that}.postMessage(stop)",{"this":"{that}.worker",method:"terminate"}]}}),berg.clock.workerSetInterval.createWorker=function(){return berg.worker(berg.clock.workerSetInterval.workerImpl)},berg.clock.workerSetInterval.workerImpl=function(){var a={};a.workerClock=function(a){var b={options:a||{},intervalID:null};return b.start=function(){b.intervalID=setInterval(b.tick,1e3/b.options.freq)},b.tick=function(){self.postMessage({type:"tick"})},b.stop=function(){clearInterval(b.intervalID)},b},self.addEventListener("message",function(b){"start"===b.data.type?(a.clock=a.workerClock({freq:b.data.value}),a.clock.start()):"stop"===b.data.type&&(a.clock&&a.clock.stop(),self.close())},!1)}}(),function(){"use strict";fluid.defaults("berg.clock.logger",{gradeNames:["fluid.eventedComponent","autoInit"],numTicksToLog:72e3,members:{tickCounter:0,lastTickTime:null,interval:0,intervalLog:"@expand:berg.clock.logger.initLog({that}.options.numTicksToLog)"},invokers:{log:"berg.clock.logger.log({that})"},listeners:{"{clock}.events.onTick":["{that}.log()"]}}),berg.clock.logger.initLog=function(a){return new Float32Array(a)},berg.clock.logger.log=function(a){return null===a.lastTickTime?void(a.lastTickTime=a.time):(a.tickCounter++,a.interval=a.time-a.lastTickTime,void(a.tickCounter<a.options.numTicksToLog&&(a.intervalLog[a.tickCounter]=a.interval)))}}(),function(){"use strict";self.addEventListener("message",function(a){"create"===a.data.type&&(self.activeComponent&&self.activeComponent.destroy(),self.activeComponent=fluid.initComponent(a.data.args[0],[a.data.args[1]]),a.stopPropagation())},!0)}();